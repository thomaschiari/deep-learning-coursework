<!DOCTYPE html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Thomas Chiari Ciocchetti de Souza"><link href=https://thomaschiari.github.io/deep-learning-coursework/mlp/mlp-exercise/ rel=canonical><link href=../../perceptron/perceptron-exercise/ rel=prev><link href=../../classification-project/classification-project/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.18"><title>MLP Task - Deep Learning Coursework</title><link rel=stylesheet href=../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M64%20480c-35.3%200-64-28.7-64-64V96c0-35.3%2028.7-64%2064-64h320c35.3%200%2064%2028.7%2064%2064v213.5c0%2017-6.7%2033.3-18.7%2045.3L322.7%20461.3c-12%2012-28.3%2018.7-45.3%2018.7zm325.5-176H296c-13.3%200-24%2010.7-24%2024v93.5z%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M384%20512H96c-53%200-96-43-96-96V96C0%2043%2043%200%2096%200h304c26.5%200%2048%2021.5%2048%2048v288c0%2020.9-13.4%2038.7-32%2045.3V448c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032zM96%20384c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h256v-64zm32-232c0%2013.3%2010.7%2024%2024%2024h176c13.3%200%2024-10.7%2024-24s-10.7-24-24-24H152c-13.3%200-24%2010.7-24%2024m24%2072c-13.3%200-24%2010.7-24%2024s10.7%2024%2024%2024h176c13.3%200%2024-10.7%2024-24s-10.7-24-24-24z%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m-32-352a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200m-8%2064h48c13.3%200%2024%2010.7%2024%2024v88h8c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-80c-13.3%200-24-10.7-24-24s10.7-24%2024-24h24v-64h-24c-13.3%200-24-10.7-24-24s10.7-24%2024-24%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M461.2%2018.9C472.7%2024%20480%2035.4%20480%2048v416c0%2012.6-7.3%2024-18.8%2029.1s-24.8%203.2-34.3-5.1l-46.6-40.7c-43.6-38.1-98.7-60.3-156.4-63V480c0%2017.7-14.3%2032-32%2032h-32c-17.7%200-32-14.3-32-32v-96C57.3%20384%200%20326.7%200%20256s57.3-128%20128-128h84.5c61.8-.2%20121.4-22.7%20167.9-63.3L427%2024c9.4-8.3%2022.9-10.2%2034.3-5.1zM224%20320v.2c70.3%202.7%20137.8%2028.5%20192%2073.4V118.3c-54.2%2044.9-121.7%2070.7-192%2073.4z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M434.8%2070.1c14.3%2010.4%2017.5%2030.4%207.1%2044.7l-256%20352c-5.5%207.6-14%2012.3-23.4%2013.1s-18.5-2.7-25.1-9.3l-128-128c-12.5-12.5-12.5-32.8%200-45.3s32.8-12.5%2045.3%200l101.5%20101.5%20234-321.7c10.4-14.3%2030.4-17.5%2044.7-7.1z%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m0-336c-17.7%200-32%2014.3-32%2032%200%2013.3-10.7%2024-24%2024s-24-10.7-24-24c0-44.2%2035.8-80%2080-80s80%2035.8%2080%2080c0%2047.2-36%2067.2-56%2074.5v3.8c0%2013.3-10.7%2024-24%2024s-24-10.7-24-24v-8.1c0-20.5%2014.8-35.2%2030.1-40.2%206.4-2.1%2013.2-5.5%2018.2-10.3%204.3-4.2%207.7-10%207.7-19.6%200-17.7-14.3-32-32-32zm-32%20192a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M256%200c14.7%200%2028.2%208.1%2035.2%2021l216%20400c6.7%2012.4%206.4%2027.4-.8%2039.5S486.1%20480%20472%20480H40c-14.1%200-27.1-7.4-34.4-19.5s-7.5-27.1-.8-39.5l216-400c7-12.9%2020.5-21%2035.2-21m0%20168c-13.3%200-24%2010.7-24%2024v112c0%2013.3%2010.7%2024%2024%2024s24-10.7%2024-24V192c0-13.3-10.7-24-24-24m26.7%20216a26.7%2026.7%200%201%200-53.3%200%2026.7%2026.7%200%201%200%2053.3%200%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M480-16c6.9%200%2013%204.4%2015.2%2010.9l13.5%2040.4%2040.4%2013.5C555.6%2051%20560%2057.1%20560%2064s-4.4%2013-10.9%2015.2l-40.4%2013.5-13.5%2040.4c-2.2%206.5-8.3%2010.9-15.2%2010.9s-13-4.4-15.2-10.9l-13.5-40.4-40.4-13.5C404.4%2077%20400%2070.9%20400%2064s4.4-13%2010.9-15.2l40.4-13.5%2013.5-40.4C467-11.6%20473.1-16%20480-16M321.4%2097.4c12.5-12.5%2032.8-12.5%2045.3%200l80%2080c12.5%2012.5%2012.5%2032.8%200%2045.3l-10.9%2010.9c7.9%2022%2012.2%2045.7%2012.2%2070.5%200%20114.9-93.1%20208-208%20208S32%20418.9%2032%20304%20125.1%2096%20240%2096c24.7%200%2048.5%204.3%2070.5%2012.3zM144%20304c0-53%2043-96%2096-96%2013.3%200%2024-10.7%2024-24s-10.7-24-24-24c-79.5%200-144%2064.5-144%20144%200%2013.3%2010.7%2024%2024%2024s24-10.7%2024-24%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M416%20427.4c58.5-44%2096-111.6%2096-187.4C512%20107.5%20397.4%200%20256%200S0%20107.5%200%20240c0%2075.8%2037.5%20143.4%2096%20187.4V464c0%2026.5%2021.5%2048%2048%2048h32v-40c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v40h64v-40c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v40h32c26.5%200%2048-21.5%2048-48zM96%20256a64%2064%200%201%201%20128%200%2064%2064%200%201%201-128%200m256-64a64%2064%200%201%201%200%20128%2064%2064%200%201%201%200-128%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M352%200c0-17.7-14.3-32-32-32s-32%2014.3-32%2032v64h-96c-53%200-96%2043-96%2096v224c0%2053%2043%2096%2096%2096h256c53%200%2096-43%2096-96V160c0-53-43-96-96-96h-96zM160%20368c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24M224%20176a48%2048%200%201%201%200%2096%2048%2048%200%201%201%200-96m144%2048a48%2048%200%201%201%2096%200%2048%2048%200%201%201-96%200m-304%200c0-17.7-14.3-32-32-32S0%20206.3%200%20224v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32zm544-32c-17.7%200-32%2014.3-32%2032v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32v-96c0-17.7-14.3-32-32-32%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M288%200H128c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032v151.5L7.5%20426.3C2.6%20435%200%20444.7%200%20454.7%200%20486.4%2025.6%20512%2057.3%20512h333.4c31.6%200%2057.3-25.6%2057.3-57.3%200-10-2.6-19.8-7.5-28.4L320%20215.5V64c17.7%200%2032-14.3%2032-32S337.7%200%20320%200zm-96%20215.5V64h64v151.5c0%2011.1%202.9%2022.1%208.4%2031.8L306%20320H142l41.6-72.7c5.5-9.7%208.4-20.6%208.4-31.8%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.0.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20fill%3D%22currentColor%22%20d%3D%22M0%20216C0%20149.7%2053.7%2096%20120%2096h8c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032h-8c-30.9%200-56%2025.1-56%2056v8h64c35.3%200%2064%2028.7%2064%2064v64c0%2035.3-28.7%2064-64%2064H64c-35.3%200-64-28.7-64-64zm256%200c0-66.3%2053.7-120%20120-120h8c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032h-8c-30.9%200-56%2025.1-56%2056v8h64c35.3%200%2064%2028.7%2064%2064v64c0%2035.3-28.7%2064-64%2064h-64c-35.3%200-64-28.7-64-64z%22/%3E%3C/svg%3E');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_markdown_exec_pyodide.css><link rel=stylesheet href=../../assets/_markdown_exec_ansi.css><link rel=stylesheet href=../../assets/stylesheets/badge.css><link rel=stylesheet href=../../termynal.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../assets/stylesheets/glightbox.min.css rel=stylesheet><script src=../../assets/javascripts/glightbox.min.js></script><style id=glightbox-style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=grey data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#mlp-task class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Deep Learning Coursework" class="md-header__button md-logo" aria-label="Deep Learning Coursework" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Deep Learning Coursework </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> MLP Task </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=grey data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"></path></svg> </label> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=grey data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"></path></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=grey data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_3 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"></path></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=grey data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_3> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/thomaschiari/deep-learning-coursework title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class=md-source__repository> github/deep-learning-coursework </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Deep Learning Coursework" class="md-nav__button md-logo" aria-label="Deep Learning Coursework" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> Deep Learning Coursework </label> <div class=md-nav__source> <a href=https://github.com/thomaschiari/deep-learning-coursework title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class=md-source__repository> github/deep-learning-coursework </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../data/data_exercise/ class=md-nav__link> <span class=md-ellipsis> Data Task </span> </a> </li> <li class=md-nav__item> <a href=../../perceptron/perceptron-exercise/ class=md-nav__link> <span class=md-ellipsis> Perceptron Task </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> MLP Task </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> MLP Task </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#exercise-1-manual-calculation-of-mlp-steps class=md-nav__link> <span class=md-ellipsis> Exercise 1 - Manual Calculation of MLP Steps </span> </a> <nav class=md-nav aria-label="Exercise 1 - Manual Calculation of MLP Steps"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-forward-pass class=md-nav__link> <span class=md-ellipsis> 1. Forward pass </span> </a> </li> <li class=md-nav__item> <a href=#2-backward-pass class=md-nav__link> <span class=md-ellipsis> 2. Backward pass </span> </a> </li> <li class=md-nav__item> <a href=#3-parameter-update-gradient-descent class=md-nav__link> <span class=md-ellipsis> 3. Parameter update (gradient descent) </span> </a> </li> <li class=md-nav__item> <a href=#4-final-parameters class=md-nav__link> <span class=md-ellipsis> 4. Final parameters </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#exercise-2-binary-classification-and-mlp class=md-nav__link> <span class=md-ellipsis> Exercise 2 — Binary Classification and MLP </span> </a> <nav class=md-nav aria-label="Exercise 2 — Binary Classification and MLP"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-data-generation class=md-nav__link> <span class=md-ellipsis> 1. Data generation </span> </a> </li> <li class=md-nav__item> <a href=#2-mlp-implementation class=md-nav__link> <span class=md-ellipsis> 2. MLP implementation </span> </a> </li> <li class=md-nav__item> <a href=#3-training-and-results class=md-nav__link> <span class=md-ellipsis> 3. Training and results </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#exercise-3-multiclass-classification-with-mlp class=md-nav__link> <span class=md-ellipsis> Exercise 3 — Multiclass classification with MLP </span> </a> <nav class=md-nav aria-label="Exercise 3 — Multiclass classification with MLP"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-data-generation_1 class=md-nav__link> <span class=md-ellipsis> 1. Data generation </span> </a> </li> <li class=md-nav__item> <a href=#2-mlp-changes class=md-nav__link> <span class=md-ellipsis> 2. MLP changes </span> </a> </li> <li class=md-nav__item> <a href=#3-training-and-results_1 class=md-nav__link> <span class=md-ellipsis> 3. Training and results </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#exercise-4-deeper-mlp-on-multiclass-dataset class=md-nav__link> <span class=md-ellipsis> Exercise 4 — Deeper MLP on multiclass dataset </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../classification-project/classification-project/ class=md-nav__link> <span class=md-ellipsis> Classification Project </span> </a> </li> <li class=md-nav__item> <a href=../../vae/vae-exercise/ class=md-nav__link> <span class=md-ellipsis> VAE Task </span> </a> </li> <li class=md-nav__item> <a href=../../regression-project/regression-project/ class=md-nav__link> <span class=md-ellipsis> Regression Project </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#exercise-1-manual-calculation-of-mlp-steps class=md-nav__link> <span class=md-ellipsis> Exercise 1 - Manual Calculation of MLP Steps </span> </a> <nav class=md-nav aria-label="Exercise 1 - Manual Calculation of MLP Steps"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-forward-pass class=md-nav__link> <span class=md-ellipsis> 1. Forward pass </span> </a> </li> <li class=md-nav__item> <a href=#2-backward-pass class=md-nav__link> <span class=md-ellipsis> 2. Backward pass </span> </a> </li> <li class=md-nav__item> <a href=#3-parameter-update-gradient-descent class=md-nav__link> <span class=md-ellipsis> 3. Parameter update (gradient descent) </span> </a> </li> <li class=md-nav__item> <a href=#4-final-parameters class=md-nav__link> <span class=md-ellipsis> 4. Final parameters </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#exercise-2-binary-classification-and-mlp class=md-nav__link> <span class=md-ellipsis> Exercise 2 — Binary Classification and MLP </span> </a> <nav class=md-nav aria-label="Exercise 2 — Binary Classification and MLP"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-data-generation class=md-nav__link> <span class=md-ellipsis> 1. Data generation </span> </a> </li> <li class=md-nav__item> <a href=#2-mlp-implementation class=md-nav__link> <span class=md-ellipsis> 2. MLP implementation </span> </a> </li> <li class=md-nav__item> <a href=#3-training-and-results class=md-nav__link> <span class=md-ellipsis> 3. Training and results </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#exercise-3-multiclass-classification-with-mlp class=md-nav__link> <span class=md-ellipsis> Exercise 3 — Multiclass classification with MLP </span> </a> <nav class=md-nav aria-label="Exercise 3 — Multiclass classification with MLP"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-data-generation_1 class=md-nav__link> <span class=md-ellipsis> 1. Data generation </span> </a> </li> <li class=md-nav__item> <a href=#2-mlp-changes class=md-nav__link> <span class=md-ellipsis> 2. MLP changes </span> </a> </li> <li class=md-nav__item> <a href=#3-training-and-results_1 class=md-nav__link> <span class=md-ellipsis> 3. Training and results </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#exercise-4-deeper-mlp-on-multiclass-dataset class=md-nav__link> <span class=md-ellipsis> Exercise 4 — Deeper MLP on multiclass dataset </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=mlp-task>MLP Task</h1> <p>The complete source code for this task is available <a href=https://github.com/thomaschiari/deep-learning-mlp-task>here</a>.</p> <h2 id=exercise-1-manual-calculation-of-mlp-steps>Exercise 1 - Manual Calculation of MLP Steps</h2> <p>We consider a MLP with 2 features, 1 layer with 2 neurons, and 1 output neuron, with tanh activations and MSE loss <span class=arithmatex>\(L=\frac{1}{N}(y-\hat y)^2\)</span> (<span class=arithmatex>\(N=1\)</span>). For the parameter update, use learning rate <span class=arithmatex>\(\eta=0.1\)</span>.</p> <p><strong>Given</strong></p> <div class=arithmatex>\[ \mathbf{x}=\begin{bmatrix}0.5\\-0.2\end{bmatrix},\quad y=1.0,\quad \mathbf{W}^{(1)}=\begin{bmatrix}0.3&amp;-0.1\\0.2&amp;0.4\end{bmatrix},\quad \mathbf{b}^{(1)}=\begin{bmatrix}0.1\\-0.2\end{bmatrix}, \]</div> <div class=arithmatex>\[ \mathbf{W}^{(2)}=\begin{bmatrix}0.5&amp;-0.3\end{bmatrix},\quad b^{(2)}=0.2,\quad \text{activation } \tanh(u),\quad L=(y-\hat y)^2. \]</div> <h3 id=1-forward-pass>1. Forward pass</h3> <p><strong>Hidden pre-activation</strong></p> <div class=arithmatex>\[ \mathbf{z}^{(1)}=\mathbf{W}^{(1)}\mathbf{x}+\mathbf{b}^{(1)} =\begin{bmatrix}0.3&amp;-0.1\\0.2&amp;0.4\end{bmatrix} \begin{bmatrix}0.5\\-0.2\end{bmatrix} +\begin{bmatrix}0.1\\-0.2\end{bmatrix} =\begin{bmatrix}0.27\\-0.18\end{bmatrix}. \]</div> <p><strong>Hidden activation</strong></p> <div class=arithmatex>\[ \mathbf{h}^{(1)}=\tanh(\mathbf{z}^{(1)}) =\begin{bmatrix}\tanh(0.27)\\ \tanh(-0.18)\end{bmatrix} \approx \begin{bmatrix}0.26362484\\-0.17808087\end{bmatrix}. \]</div> <p><strong>Output pre-activation</strong></p> <div class=arithmatex>\[ u^{(2)}=\mathbf{W}^{(2)}\mathbf{h}^{(1)}+b^{(2)} =0.5\cdot 0.26362484+(-0.3)\cdot(-0.17808087)+0.2 \approx 0.3852366782. \]</div> <p><strong>Output activation and loss</strong></p> <div class=arithmatex>\[ \hat y=\tanh(u^{(2)})\approx \tanh(0.3852366782)\approx 0.3672465626, \]</div> <div class=arithmatex>\[ L=(y-\hat y)^2=(1-0.3672465626)^2\approx 0.4003769125. \]</div> <h3 id=2-backward-pass>2. Backward pass</h3> <p>Useful derivative: $$ \frac{d}{du}\tanh(u)=1-\tanh^2(u). $$</p> <p><strong>From loss to output:</strong></p> <div class=arithmatex>\[ \frac{\partial L}{\partial \hat y}=2(\hat y-1)\approx -1.2655068747, \]</div> <div class=arithmatex>\[ \frac{\partial \hat y}{\partial u^{(2)}}=1-\tanh^2(u^{(2)})=1-\hat y^2\approx 0.8651299622, \]</div> <div class=arithmatex>\[ \frac{\partial L}{\partial u^{(2)}}=\frac{\partial L}{\partial \hat y}\cdot \frac{\partial \hat y}{\partial u^{(2)}} \approx (-1.2655068747)\cdot 0.8651299622\approx -1.0948279147. \]</div> <p><strong>Output layer gradients:</strong></p> <div class=arithmatex>\[ \frac{\partial L}{\partial \mathbf{W}^{(2)}}=\frac{\partial L}{\partial u^{(2)}}\,(\mathbf{h}^{(1)})^\top \approx \begin{bmatrix} -1.0948279147\cdot 0.26362484 &amp; -1.0948279147\cdot (-0.17808087) \end{bmatrix} \approx \begin{bmatrix}-0.28862383 &amp; 0.19496791\end{bmatrix}, \]</div> <div class=arithmatex>\[ \frac{\partial L}{\partial b^{(2)}}=\frac{\partial L}{\partial u^{(2)}}\approx -1.0948279147. \]</div> <p><strong>Backpropagated to hidden activation:</strong></p> <div class=arithmatex>\[ \frac{\partial L}{\partial \mathbf{h}^{(1)}}= \left(\frac{\partial L}{\partial u^{(2)}}\right)(\mathbf{W}^{(2)})^\top \approx -1.0948279147\cdot \begin{bmatrix}0.5\\-0.3\end{bmatrix} \approx \begin{bmatrix}-0.54741396\\ 0.32844837\end{bmatrix}. \]</div> <p><strong>Hidden activation derivative:</strong></p> <div class=arithmatex>\[ 1-\tanh^2(\mathbf{z}^{(1)})= \begin{bmatrix} 1-\tanh^2(0.27)\\[2pt] 1-\tanh^2(-0.18) \end{bmatrix} \approx \begin{bmatrix} 0.93050195\\ 0.96828720 \end{bmatrix}. \]</div> <p><strong>Hidden pre-activation gradient:</strong></p> <div class=arithmatex>\[ \frac{\partial L}{\partial \mathbf{z}^{(1)}}= \frac{\partial L}{\partial \mathbf{h}^{(1)}}\odot \left(1-\tanh^2(\mathbf{z}^{(1)})\right) \approx \begin{bmatrix}-0.54741396\\ 0.32844837\end{bmatrix}\odot \begin{bmatrix}0.93050195\\ 0.96828720\end{bmatrix} \approx \begin{bmatrix}-0.50936975\\ 0.31803236\end{bmatrix}. \]</div> <p><strong>Hidden layer parameter gradients:</strong></p> <div class=arithmatex>\[ \frac{\partial L}{\partial \mathbf{W}^{(1)}}= \frac{\partial L}{\partial \mathbf{z}^{(1)}}\,\mathbf{x}^\top = \begin{bmatrix}-0.50936975\\ 0.31803236\end{bmatrix} \begin{bmatrix}0.5 &amp; -0.2\end{bmatrix} \approx \begin{bmatrix} -0.25468488 &amp; 0.10187395\\ \ \ 0.15901618 &amp; -0.06360647 \end{bmatrix}, \]</div> <div class=arithmatex>\[ \frac{\partial L}{\partial \mathbf{b}^{(1)}}=\frac{\partial L}{\partial \mathbf{z}^{(1)}} \approx \begin{bmatrix}-0.50936975\\ 0.31803236\end{bmatrix}. \]</div> <h3 id=3-parameter-update-gradient-descent>3. Parameter update (gradient descent)</h3> <p><strong>Output layer:</strong></p> <div class=arithmatex>\[ \mathbf{W}^{(2)}\leftarrow \mathbf{W}^{(2)}-\eta\,\frac{\partial L}{\partial \mathbf{W}^{(2)}} = \begin{bmatrix}0.5&amp;-0.3\end{bmatrix} -0.1\begin{bmatrix}-0.28862383&amp;0.19496791\end{bmatrix} = \begin{bmatrix}0.52886238&amp;-0.31949679\end{bmatrix}, \]</div> <div class=arithmatex>\[ b^{(2)}\leftarrow b^{(2)}-\eta\,\frac{\partial L}{\partial b^{(2)}} =0.2-0.1(-1.0948279147)\approx 0.3094827915. \]</div> <p><strong>Hidden layer:</strong> $$ \mathbf{W}^{(1)}\leftarrow \mathbf{W}^{(1)}-\eta\,\frac{\partial L}{\partial \mathbf{W}^{(1)}} = \begin{bmatrix}0.3&amp;-0.1\ 0.2&amp;0.4\end{bmatrix} -0.1 \begin{bmatrix} -0.25468488 &amp; 0.10187395\ 0.15901618 &amp; -0.06360647 \end{bmatrix} \approx \begin{bmatrix} 0.32546849 &amp; -0.11018740\ 0.18409838 &amp; 0.40636065 \end{bmatrix}, $$</p> <div class=arithmatex>\[ \mathbf{b}^{(1)}\leftarrow \mathbf{b}^{(1)}-\eta\,\frac{\partial L}{\partial \mathbf{b}^{(1)}} = \begin{bmatrix}0.1\\-0.2\end{bmatrix} -0.1\begin{bmatrix}-0.50936975\\ 0.31803236\end{bmatrix} \approx \begin{bmatrix}0.15093698\\-0.23180324\end{bmatrix}. \]</div> <h3 id=4-final-parameters>4. Final parameters</h3> <ul> <li> <p><span class=arithmatex>\(\mathbf{W}^{(2)} \approx [\,0.52886238,\ -0.31949679\,]\)</span></p> </li> <li> <p><span class=arithmatex>\(b^{(2)} \approx 0.3094827915\)</span></p> </li> <li> <p><span class=arithmatex>\(\displaystyle \mathbf{W}^{(1)} \approx \begin{bmatrix} 0.32546849 &amp; -0.11018740\\ 0.18409838 &amp; \ \ 0.40636065 \end{bmatrix}\)</span></p> </li> <li> <p><span class=arithmatex>\(\displaystyle \mathbf{b}^{(1)} \approx \begin{bmatrix}0.15093698\\-0.23180324\end{bmatrix}\)</span></p> </li> </ul> <h2 id=exercise-2-binary-classification-and-mlp>Exercise 2 — Binary Classification and MLP</h2> <p>We need to build a 2D binary dataset where class 0 has 1 cluster and class 1 has 2 clusters. We will use <code>make_classification</code> and compose the subsets to create this. After that, we will train a NumPy only MLP with 1 hidden tanh layer with 16 neurons, and 1 output neuron (sigmoid + BCE loss). </p> <h3 id=1-data-generation>1. Data generation</h3> <p>Here, we generate two datasets and keep only the slice we need from each, then stack and shuffle the data.</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span><span class=w> </span><span class=nf>_take_class</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=bp>cls</span><span class=p>,</span> <span class=n>n_needed</span><span class=p>):</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>    <span class=n>Xc</span> <span class=o>=</span> <span class=n>X</span><span class=p>[</span><span class=n>y</span> <span class=o>==</span> <span class=bp>cls</span><span class=p>]</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>    <span class=k>if</span> <span class=n>Xc</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>n_needed</span><span class=p>:</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>"Increase n_samples in generator"</span><span class=p>)</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>    <span class=k>return</span> <span class=n>Xc</span><span class=p>[:</span><span class=n>n_needed</span><span class=p>]</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=k>def</span><span class=w> </span><span class=nf>binary_1v2_clusters</span><span class=p>(</span><span class=n>n_total</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span> <span class=n>class_sep</span><span class=o>=</span><span class=mf>1.5</span><span class=p>):</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    <span class=n>n0</span> <span class=o>=</span> <span class=n>n1</span> <span class=o>=</span> <span class=n>n_total</span> <span class=o>//</span> <span class=mi>2</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>    <span class=n>Xa</span><span class=p>,</span> <span class=n>ya</span> <span class=o>=</span> <span class=n>make_classification</span><span class=p>(</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>        <span class=n>n_samples</span><span class=o>=</span><span class=mi>3</span><span class=o>*</span><span class=n>n0</span><span class=p>,</span> <span class=n>n_features</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>n_informative</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>n_redundant</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>        <span class=n>n_classes</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>n_clusters_per_class</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>class_sep</span><span class=o>=</span><span class=n>class_sep</span><span class=p>,</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>        <span class=n>flip_y</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=n>random_state</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>    <span class=p>)</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>    <span class=n>X0</span> <span class=o>=</span> <span class=n>_take_class</span><span class=p>(</span><span class=n>Xa</span><span class=p>,</span> <span class=n>ya</span><span class=p>,</span> <span class=bp>cls</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>n_needed</span><span class=o>=</span><span class=n>n0</span><span class=p>)</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>    <span class=n>Xb</span><span class=p>,</span> <span class=n>yb</span> <span class=o>=</span> <span class=n>make_classification</span><span class=p>(</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>        <span class=n>n_samples</span><span class=o>=</span><span class=mi>3</span><span class=o>*</span><span class=n>n1</span><span class=p>,</span> <span class=n>n_features</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>n_informative</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>n_redundant</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>        <span class=n>n_classes</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>n_clusters_per_class</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>class_sep</span><span class=o>=</span><span class=n>class_sep</span><span class=p>,</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>        <span class=n>flip_y</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=n>random_state</span> <span class=o>+</span> <span class=mi>1</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>    <span class=p>)</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>    <span class=n>X1</span> <span class=o>=</span> <span class=n>_take_class</span><span class=p>(</span><span class=n>Xb</span><span class=p>,</span> <span class=n>yb</span><span class=p>,</span> <span class=bp>cls</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>n_needed</span><span class=o>=</span><span class=n>n1</span><span class=p>)</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>    <span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>vstack</span><span class=p>([</span><span class=n>X0</span><span class=p>,</span> <span class=n>X1</span><span class=p>])</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>    <span class=n>y</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>hstack</span><span class=p>([</span><span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>n0</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>int</span><span class=p>),</span> <span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>(</span><span class=n>n1</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>int</span><span class=p>)])</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a>    <span class=n>idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>default_rng</span><span class=p>(</span><span class=n>random_state</span> <span class=o>+</span> <span class=mi>2</span><span class=p>)</span><span class=o>.</span><span class=n>permutation</span><span class=p>(</span><span class=n>n_total</span><span class=p>)</span>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a>    <span class=k>return</span> <span class=n>X</span><span class=p>[</span><span class=n>idx</span><span class=p>],</span> <span class=n>y</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a><span class=n>rng</span> <span class=o>=</span> <span class=n>set_all_seeds</span><span class=p>(</span><span class=mi>42</span><span class=p>)</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a><span class=n>X</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>binary_1v2_clusters</span><span class=p>(</span><span class=n>n_total</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span> <span class=n>class_sep</span><span class=o>=</span><span class=mf>1.5</span><span class=p>)</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a><span class=n>Xtr</span><span class=p>,</span> <span class=n>Xte</span><span class=p>,</span> <span class=n>ytr</span><span class=p>,</span> <span class=n>yte</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>test_size</span><span class=o>=</span><span class=mf>0.2</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>7</span><span class=p>)</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=n>ytr_b</span> <span class=o>=</span> <span class=n>ytr</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></code></pre></div> <p>We get this data distribution plot:</p> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/ex2-raw.png data-desc-position=bottom><img alt="Exercise 2" src=../images/ex2-raw.png></a></p> <h3 id=2-mlp-implementation>2. MLP implementation</h3> <p>We will implement a MLP with 1 hidden tanh layer with 16 neurons, and 1 output neuron (sigmoid + BCE loss). First, we implement the layer class:</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>class</span><span class=w> </span><span class=nc>Dense</span><span class=p>:</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>in_dim</span><span class=p>,</span> <span class=n>out_dim</span><span class=p>,</span> <span class=n>activation</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>in_dim</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>out_dim</span> <span class=o>=</span> <span class=n>in_dim</span><span class=p>,</span> <span class=n>out_dim</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>        <span class=n>rng</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>default_rng</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>        <span class=n>std</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mf>1.0</span> <span class=o>/</span> <span class=n>in_dim</span><span class=p>)</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>        <span class=bp>self</span><span class=o>.</span><span class=n>W</span> <span class=o>=</span> <span class=n>rng</span><span class=o>.</span><span class=n>normal</span><span class=p>(</span><span class=n>scale</span><span class=o>=</span><span class=n>std</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>in_dim</span><span class=p>,</span> <span class=n>out_dim</span><span class=p>))</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>        <span class=bp>self</span><span class=o>.</span><span class=n>b</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>out_dim</span><span class=p>)</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>        <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>=</span> <span class=n>activation</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>    <span class=k>def</span><span class=w> </span><span class=nf>_act</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>z</span><span class=p>):</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>         
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>            <span class=k>return</span> <span class=n>z</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>==</span> <span class=s2>"tanh"</span><span class=p>:</span>       
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>            <span class=k>return</span> <span class=n>tanh</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>==</span> <span class=s2>"sigmoid"</span><span class=p>:</span>    
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>            <span class=k>return</span> <span class=n>sigmoid</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>"unknown activation </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>activation</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a>    <span class=k>def</span><span class=w> </span><span class=nf>_dact</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>z</span><span class=p>):</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>         
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a>            <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>ones_like</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>==</span> <span class=s2>"tanh"</span><span class=p>:</span>       
</span><span id=__span-1-24><a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a>            <span class=k>return</span> <span class=n>dtanh</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-1-25><a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>==</span> <span class=s2>"sigmoid"</span><span class=p>:</span>
</span><span id=__span-1-26><a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a>            <span class=n>s</span> <span class=o>=</span> <span class=n>sigmoid</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-1-27><a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a>            <span class=k>return</span> <span class=n>s</span><span class=o>*</span><span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>s</span><span class=p>)</span>
</span><span id=__span-1-28><a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>"unknown activation </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>activation</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</span><span id=__span-1-29><a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a>
</span><span id=__span-1-30><a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a>    <span class=k>def</span><span class=w> </span><span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>X</span><span class=p>):</span>
</span><span id=__span-1-31><a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a>        <span class=n>Z</span> <span class=o>=</span> <span class=n>X</span> <span class=o>@</span> <span class=bp>self</span><span class=o>.</span><span class=n>W</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>b</span>
</span><span id=__span-1-32><a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a>        <span class=n>A</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_act</span><span class=p>(</span><span class=n>Z</span><span class=p>)</span>
</span><span id=__span-1-33><a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=s2>"X"</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=s2>"Z"</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=s2>"A"</span><span class=p>]</span> <span class=o>=</span> <span class=n>X</span><span class=p>,</span> <span class=n>Z</span><span class=p>,</span> <span class=n>A</span>
</span><span id=__span-1-34><a id=__codelineno-1-34 name=__codelineno-1-34 href=#__codelineno-1-34></a>        <span class=k>return</span> <span class=n>A</span>
</span><span id=__span-1-35><a id=__codelineno-1-35 name=__codelineno-1-35 href=#__codelineno-1-35></a>
</span><span id=__span-1-36><a id=__codelineno-1-36 name=__codelineno-1-36 href=#__codelineno-1-36></a>    <span class=k>def</span><span class=w> </span><span class=nf>backward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dA</span><span class=p>,</span> <span class=n>lr</span><span class=p>):</span>
</span><span id=__span-1-37><a id=__codelineno-1-37 name=__codelineno-1-37 href=#__codelineno-1-37></a>        <span class=n>X</span><span class=p>,</span> <span class=n>Z</span><span class=p>,</span> <span class=n>A</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=s2>"X"</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=s2>"Z"</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=s2>"A"</span><span class=p>]</span>
</span><span id=__span-1-38><a id=__codelineno-1-38 name=__codelineno-1-38 href=#__codelineno-1-38></a>        <span class=n>dZ</span> <span class=o>=</span> <span class=n>dA</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dact</span><span class=p>(</span><span class=n>Z</span><span class=p>)</span>
</span><span id=__span-1-39><a id=__codelineno-1-39 name=__codelineno-1-39 href=#__codelineno-1-39></a>        <span class=n>dW</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>T</span> <span class=o>@</span> <span class=n>dZ</span> <span class=o>/</span> <span class=n>X</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-1-40><a id=__codelineno-1-40 name=__codelineno-1-40 href=#__codelineno-1-40></a>        <span class=n>db</span> <span class=o>=</span> <span class=n>dZ</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-1-41><a id=__codelineno-1-41 name=__codelineno-1-41 href=#__codelineno-1-41></a>        <span class=n>dX</span> <span class=o>=</span> <span class=n>dZ</span> <span class=o>@</span> <span class=bp>self</span><span class=o>.</span><span class=n>W</span><span class=o>.</span><span class=n>T</span>
</span><span id=__span-1-42><a id=__codelineno-1-42 name=__codelineno-1-42 href=#__codelineno-1-42></a>        <span class=bp>self</span><span class=o>.</span><span class=n>W</span> <span class=o>-=</span> <span class=n>lr</span> <span class=o>*</span> <span class=n>dW</span>
</span><span id=__span-1-43><a id=__codelineno-1-43 name=__codelineno-1-43 href=#__codelineno-1-43></a>        <span class=bp>self</span><span class=o>.</span><span class=n>b</span> <span class=o>-=</span> <span class=n>lr</span> <span class=o>*</span> <span class=n>db</span>
</span><span id=__span-1-44><a id=__codelineno-1-44 name=__codelineno-1-44 href=#__codelineno-1-44></a>        <span class=k>return</span> <span class=n>dX</span>
</span></code></pre></div> <p>Then, we implement the MLP class, that uses the layer class:</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>class</span><span class=w> </span><span class=nc>MLP</span><span class=p>:</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>layer_dims</span><span class=p>,</span> <span class=n>hidden_activation</span><span class=o>=</span><span class=s2>"tanh"</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>layers</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>        <span class=n>rng</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>default_rng</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>layer_dims</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>):</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>            <span class=n>act</span> <span class=o>=</span> <span class=n>hidden_activation</span> <span class=k>if</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>layer_dims</span><span class=p>)</span> <span class=o>-</span> <span class=mi>2</span> <span class=k>else</span> <span class=s2>"sigmoid"</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>            <span class=bp>self</span><span class=o>.</span><span class=n>layers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>                <span class=n>Dense</span><span class=p>(</span><span class=n>layer_dims</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>layer_dims</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span> <span class=n>activation</span><span class=o>=</span><span class=n>act</span><span class=p>,</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>                      <span class=n>seed</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>rng</span><span class=o>.</span><span class=n>integers</span><span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>30</span><span class=p>)))</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>            <span class=p>)</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a>    <span class=k>def</span><span class=w> </span><span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>X</span><span class=p>):</span>
</span><span id=__span-2-14><a id=__codelineno-2-14 name=__codelineno-2-14 href=#__codelineno-2-14></a>        <span class=n>A</span> <span class=o>=</span> <span class=n>X</span>
</span><span id=__span-2-15><a id=__codelineno-2-15 name=__codelineno-2-15 href=#__codelineno-2-15></a>        <span class=k>for</span> <span class=n>lyr</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>layers</span><span class=p>:</span>
</span><span id=__span-2-16><a id=__codelineno-2-16 name=__codelineno-2-16 href=#__codelineno-2-16></a>            <span class=n>A</span> <span class=o>=</span> <span class=n>lyr</span><span class=o>.</span><span class=n>forward</span><span class=p>(</span><span class=n>A</span><span class=p>)</span>
</span><span id=__span-2-17><a id=__codelineno-2-17 name=__codelineno-2-17 href=#__codelineno-2-17></a>        <span class=k>return</span> <span class=n>A</span> 
</span><span id=__span-2-18><a id=__codelineno-2-18 name=__codelineno-2-18 href=#__codelineno-2-18></a>
</span><span id=__span-2-19><a id=__codelineno-2-19 name=__codelineno-2-19 href=#__codelineno-2-19></a>    <span class=k>def</span><span class=w> </span><span class=nf>_bce_and_grad</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>A</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span>
</span><span id=__span-2-20><a id=__codelineno-2-20 name=__codelineno-2-20 href=#__codelineno-2-20></a>        <span class=n>eps</span> <span class=o>=</span> <span class=mf>1e-12</span>
</span><span id=__span-2-21><a id=__codelineno-2-21 name=__codelineno-2-21 href=#__codelineno-2-21></a>        <span class=n>A</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>clip</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>eps</span><span class=p>,</span> <span class=mf>1.0</span> <span class=o>-</span> <span class=n>eps</span><span class=p>)</span>
</span><span id=__span-2-22><a id=__codelineno-2-22 name=__codelineno-2-22 href=#__codelineno-2-22></a>        <span class=n>loss</span> <span class=o>=</span> <span class=o>-</span><span class=p>(</span><span class=n>y</span><span class=o>*</span><span class=n>np</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>A</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=mi>1</span><span class=o>-</span><span class=n>y</span><span class=p>)</span><span class=o>*</span><span class=n>np</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=mi>1</span><span class=o>-</span><span class=n>A</span><span class=p>))</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-2-23><a id=__codelineno-2-23 name=__codelineno-2-23 href=#__codelineno-2-23></a>        <span class=n>dZ</span> <span class=o>=</span> <span class=p>(</span><span class=n>A</span> <span class=o>-</span> <span class=n>y</span><span class=p>)</span>
</span><span id=__span-2-24><a id=__codelineno-2-24 name=__codelineno-2-24 href=#__codelineno-2-24></a>        <span class=k>return</span> <span class=nb>float</span><span class=p>(</span><span class=n>loss</span><span class=p>),</span> <span class=n>dZ</span>
</span><span id=__span-2-25><a id=__codelineno-2-25 name=__codelineno-2-25 href=#__codelineno-2-25></a>
</span><span id=__span-2-26><a id=__codelineno-2-26 name=__codelineno-2-26 href=#__codelineno-2-26></a>    <span class=k>def</span><span class=w> </span><span class=nf>fit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>epochs</span><span class=o>=</span><span class=mi>200</span><span class=p>,</span> <span class=n>lr</span><span class=o>=</span><span class=mf>1e-1</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=mi>64</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>verbose</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span><span id=__span-2-27><a id=__codelineno-2-27 name=__codelineno-2-27 href=#__codelineno-2-27></a>        <span class=n>rng</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>default_rng</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span><span id=__span-2-28><a id=__codelineno-2-28 name=__codelineno-2-28 href=#__codelineno-2-28></a>        <span class=n>n</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-2-29><a id=__codelineno-2-29 name=__codelineno-2-29 href=#__codelineno-2-29></a>        <span class=n>hist</span> <span class=o>=</span> <span class=p>{</span><span class=s2>"loss"</span><span class=p>:</span> <span class=p>[]}</span>
</span><span id=__span-2-30><a id=__codelineno-2-30 name=__codelineno-2-30 href=#__codelineno-2-30></a>
</span><span id=__span-2-31><a id=__codelineno-2-31 name=__codelineno-2-31 href=#__codelineno-2-31></a>        <span class=k>for</span> <span class=n>ep</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>epochs</span><span class=p>):</span>
</span><span id=__span-2-32><a id=__codelineno-2-32 name=__codelineno-2-32 href=#__codelineno-2-32></a>            <span class=n>idx</span> <span class=o>=</span> <span class=n>rng</span><span class=o>.</span><span class=n>permutation</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span><span id=__span-2-33><a id=__codelineno-2-33 name=__codelineno-2-33 href=#__codelineno-2-33></a>            <span class=n>Xs</span><span class=p>,</span> <span class=n>ys</span> <span class=o>=</span> <span class=n>X</span><span class=p>[</span><span class=n>idx</span><span class=p>],</span> <span class=n>y</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
</span><span id=__span-2-34><a id=__codelineno-2-34 name=__codelineno-2-34 href=#__codelineno-2-34></a>            <span class=n>ep_losses</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-2-35><a id=__codelineno-2-35 name=__codelineno-2-35 href=#__codelineno-2-35></a>
</span><span id=__span-2-36><a id=__codelineno-2-36 name=__codelineno-2-36 href=#__codelineno-2-36></a>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>):</span>
</span><span id=__span-2-37><a id=__codelineno-2-37 name=__codelineno-2-37 href=#__codelineno-2-37></a>                <span class=n>xb</span> <span class=o>=</span> <span class=n>Xs</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=n>batch_size</span><span class=p>]</span>
</span><span id=__span-2-38><a id=__codelineno-2-38 name=__codelineno-2-38 href=#__codelineno-2-38></a>                <span class=n>yb</span> <span class=o>=</span> <span class=n>ys</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=n>batch_size</span><span class=p>]</span>
</span><span id=__span-2-39><a id=__codelineno-2-39 name=__codelineno-2-39 href=#__codelineno-2-39></a>                <span class=n>A</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>forward</span><span class=p>(</span><span class=n>xb</span><span class=p>)</span>
</span><span id=__span-2-40><a id=__codelineno-2-40 name=__codelineno-2-40 href=#__codelineno-2-40></a>                <span class=n>loss</span><span class=p>,</span> <span class=n>dZlast</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_bce_and_grad</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>yb</span><span class=p>)</span>
</span><span id=__span-2-41><a id=__codelineno-2-41 name=__codelineno-2-41 href=#__codelineno-2-41></a>                <span class=n>ep_losses</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>loss</span><span class=p>)</span>
</span><span id=__span-2-42><a id=__codelineno-2-42 name=__codelineno-2-42 href=#__codelineno-2-42></a>
</span><span id=__span-2-43><a id=__codelineno-2-43 name=__codelineno-2-43 href=#__codelineno-2-43></a>                <span class=n>dA</span> <span class=o>=</span> <span class=n>dZlast</span>
</span><span id=__span-2-44><a id=__codelineno-2-44 name=__codelineno-2-44 href=#__codelineno-2-44></a>                <span class=k>for</span> <span class=n>lyr</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>layers</span><span class=p>):</span>
</span><span id=__span-2-45><a id=__codelineno-2-45 name=__codelineno-2-45 href=#__codelineno-2-45></a>                    <span class=n>dA</span> <span class=o>=</span> <span class=n>lyr</span><span class=o>.</span><span class=n>backward</span><span class=p>(</span><span class=n>dA</span><span class=p>,</span> <span class=n>lr</span><span class=p>)</span>
</span><span id=__span-2-46><a id=__codelineno-2-46 name=__codelineno-2-46 href=#__codelineno-2-46></a>
</span><span id=__span-2-47><a id=__codelineno-2-47 name=__codelineno-2-47 href=#__codelineno-2-47></a>            <span class=n>hist</span><span class=p>[</span><span class=s2>"loss"</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>ep_losses</span><span class=p>))</span>
</span><span id=__span-2-48><a id=__codelineno-2-48 name=__codelineno-2-48 href=#__codelineno-2-48></a>            <span class=k>if</span> <span class=n>verbose</span> <span class=ow>and</span> <span class=p>(</span><span class=n>ep</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=mi>20</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-2-49><a id=__codelineno-2-49 name=__codelineno-2-49 href=#__codelineno-2-49></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>"epoch </span><span class=si>{</span><span class=n>ep</span><span class=o>+</span><span class=mi>1</span><span class=si>}</span><span class=s2>: loss=</span><span class=si>{</span><span class=n>hist</span><span class=p>[</span><span class=s1>'loss'</span><span class=p>][</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</span><span id=__span-2-50><a id=__codelineno-2-50 name=__codelineno-2-50 href=#__codelineno-2-50></a>        <span class=k>return</span> <span class=n>hist</span>
</span><span id=__span-2-51><a id=__codelineno-2-51 name=__codelineno-2-51 href=#__codelineno-2-51></a>
</span><span id=__span-2-52><a id=__codelineno-2-52 name=__codelineno-2-52 href=#__codelineno-2-52></a>    <span class=k>def</span><span class=w> </span><span class=nf>predict</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>X</span><span class=p>):</span>
</span><span id=__span-2-53><a id=__codelineno-2-53 name=__codelineno-2-53 href=#__codelineno-2-53></a>        <span class=n>A</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>forward</span><span class=p>(</span><span class=n>X</span><span class=p>)</span><span class=o>.</span><span class=n>ravel</span><span class=p>()</span>
</span><span id=__span-2-54><a id=__codelineno-2-54 name=__codelineno-2-54 href=#__codelineno-2-54></a>        <span class=k>return</span> <span class=p>(</span><span class=n>A</span> <span class=o>&gt;=</span> <span class=mf>0.5</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
</span></code></pre></div> <h3 id=3-training-and-results>3. Training and results</h3> <p>Finally, we train the MLP in the generated dataset with the following code:</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>mlp</span> <span class=o>=</span> <span class=n>MLP</span><span class=p>(</span><span class=n>layer_dims</span><span class=o>=</span><span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span> <span class=n>hidden_activation</span><span class=o>=</span><span class=s2>"tanh"</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>7</span><span class=p>)</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>hist</span> <span class=o>=</span> <span class=n>mlp</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>Xtr</span><span class=p>,</span> <span class=n>ytr_b</span><span class=p>,</span> <span class=n>epochs</span><span class=o>=</span><span class=mi>200</span><span class=p>,</span> <span class=n>lr</span><span class=o>=</span><span class=mf>1e-1</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=mi>64</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>verbose</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></code></pre></div> <p>We get the following training loss plot:</p> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/ex2-loss.png data-desc-position=bottom><img alt="Exercise 2" src=../images/ex2-loss.png></a></p> <p>In this test, we got a test accuracy of 0.9400.</p> <p>The confusion matrix is:</p> <div class=arithmatex>\[ \begin{bmatrix} 107 &amp; 4 \\ 8 &amp; 81 \end{bmatrix} \]</div> <h2 id=exercise-3-multiclass-classification-with-mlp>Exercise 3 — Multiclass classification with MLP</h2> <p>We need to build a multiclass dataset with 3 classes, 4 features, and 2, 3 and 4 clusters per class, respectively. We will use <code>make_classification</code> and compose the subsets to create this. After that, we will make slight changes to the Dense and MLP classes previously implemented, now supporting softmax and cross-entropy loss for multiclass classification. Finally, we will train the MLP.</p> <h3 id=1-data-generation_1>1. Data generation</h3> <p>Here, we generate three datasets and keep only the slice we need from each, then stack and shuffle the data. Also, we perform a PCA to reduce the dimensionality to 2D for visualization.</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>def</span><span class=w> </span><span class=nf>_take_class</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=bp>cls</span><span class=p>,</span> <span class=n>n_needed</span><span class=p>):</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>    <span class=n>Xc</span> <span class=o>=</span> <span class=n>X</span><span class=p>[</span><span class=n>y</span> <span class=o>==</span> <span class=bp>cls</span><span class=p>]</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>    <span class=k>if</span> <span class=n>Xc</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>n_needed</span><span class=p>:</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>"Increase n_samples; not enough points for requested slice."</span><span class=p>)</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>    <span class=k>return</span> <span class=n>Xc</span><span class=p>[:</span><span class=n>n_needed</span><span class=p>]</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=k>def</span><span class=w> </span><span class=nf>multiclass_2_3_4_clusters</span><span class=p>(</span><span class=n>n_total</span><span class=o>=</span><span class=mi>1500</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span> <span class=n>class_sep</span><span class=o>=</span><span class=mf>1.5</span><span class=p>):</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>    <span class=n>n_per</span> <span class=o>=</span> <span class=n>n_total</span> <span class=o>//</span> <span class=mi>3</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>    <span class=n>Xa</span><span class=p>,</span> <span class=n>ya</span> <span class=o>=</span> <span class=n>make_classification</span><span class=p>(</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>        <span class=n>n_samples</span><span class=o>=</span><span class=mi>3</span><span class=o>*</span><span class=n>n_per</span><span class=p>,</span> <span class=n>n_features</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>n_informative</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>n_redundant</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>        <span class=n>n_classes</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>n_clusters_per_class</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>class_sep</span><span class=o>=</span><span class=n>class_sep</span><span class=p>,</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a>        <span class=n>flip_y</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=n>random_state</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a>    <span class=p>)</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a>    <span class=n>X0</span> <span class=o>=</span> <span class=n>_take_class</span><span class=p>(</span><span class=n>Xa</span><span class=p>,</span> <span class=n>ya</span><span class=p>,</span> <span class=bp>cls</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>n_needed</span><span class=o>=</span><span class=n>n_per</span><span class=p>)</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>    <span class=n>Xb</span><span class=p>,</span> <span class=n>yb</span> <span class=o>=</span> <span class=n>make_classification</span><span class=p>(</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a>        <span class=n>n_samples</span><span class=o>=</span><span class=mi>3</span><span class=o>*</span><span class=n>n_per</span><span class=p>,</span> <span class=n>n_features</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>n_informative</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>n_redundant</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a>        <span class=n>n_classes</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>n_clusters_per_class</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>class_sep</span><span class=o>=</span><span class=n>class_sep</span><span class=p>,</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>        <span class=n>flip_y</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=n>random_state</span><span class=o>+</span><span class=mi>1</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a>    <span class=p>)</span>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a>    <span class=n>X1</span> <span class=o>=</span> <span class=n>_take_class</span><span class=p>(</span><span class=n>Xb</span><span class=p>,</span> <span class=n>yb</span><span class=p>,</span> <span class=bp>cls</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>n_needed</span><span class=o>=</span><span class=n>n_per</span><span class=p>)</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a>
</span><span id=__span-4-24><a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a>    <span class=n>Xc</span><span class=p>,</span> <span class=n>yc</span> <span class=o>=</span> <span class=n>make_classification</span><span class=p>(</span>
</span><span id=__span-4-25><a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a>        <span class=n>n_samples</span><span class=o>=</span><span class=mi>3</span><span class=o>*</span><span class=n>n_per</span><span class=p>,</span> <span class=n>n_features</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>n_informative</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>n_redundant</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-4-26><a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>        <span class=n>n_classes</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>n_clusters_per_class</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>class_sep</span><span class=o>=</span><span class=n>class_sep</span><span class=p>,</span>
</span><span id=__span-4-27><a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a>        <span class=n>flip_y</span><span class=o>=</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=n>random_state</span><span class=o>+</span><span class=mi>2</span>
</span><span id=__span-4-28><a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a>    <span class=p>)</span>
</span><span id=__span-4-29><a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a>    <span class=n>X2</span> <span class=o>=</span> <span class=n>_take_class</span><span class=p>(</span><span class=n>Xc</span><span class=p>,</span> <span class=n>yc</span><span class=p>,</span> <span class=bp>cls</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>n_needed</span><span class=o>=</span><span class=n>n_per</span><span class=p>)</span>
</span><span id=__span-4-30><a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a>
</span><span id=__span-4-31><a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a>    <span class=n>X</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>vstack</span><span class=p>([</span><span class=n>X0</span><span class=p>,</span> <span class=n>X1</span><span class=p>,</span> <span class=n>X2</span><span class=p>])</span>
</span><span id=__span-4-32><a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a>    <span class=n>y</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>hstack</span><span class=p>([</span>
</span><span id=__span-4-33><a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a>        <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>n_per</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>int</span><span class=p>),</span>
</span><span id=__span-4-34><a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a>        <span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>(</span><span class=n>n_per</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>int</span><span class=p>),</span>
</span><span id=__span-4-35><a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a>        <span class=mi>2</span><span class=o>*</span><span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>(</span><span class=n>n_per</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>int</span><span class=p>),</span>
</span><span id=__span-4-36><a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a>    <span class=p>])</span>
</span><span id=__span-4-37><a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a>
</span><span id=__span-4-38><a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a>    <span class=n>idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>default_rng</span><span class=p>(</span><span class=n>random_state</span><span class=o>+</span><span class=mi>3</span><span class=p>)</span><span class=o>.</span><span class=n>permutation</span><span class=p>(</span><span class=n>n_total</span><span class=p>)</span>
</span><span id=__span-4-39><a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a>    <span class=k>return</span> <span class=n>X</span><span class=p>[</span><span class=n>idx</span><span class=p>],</span> <span class=n>y</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
</span><span id=__span-4-40><a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a>
</span><span id=__span-4-41><a id=__codelineno-4-41 name=__codelineno-4-41 href=#__codelineno-4-41></a><span class=n>X</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>multiclass_2_3_4_clusters</span><span class=p>(</span><span class=n>n_total</span><span class=o>=</span><span class=mi>1500</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span> <span class=n>class_sep</span><span class=o>=</span><span class=mf>1.6</span><span class=p>)</span>
</span><span id=__span-4-42><a id=__codelineno-4-42 name=__codelineno-4-42 href=#__codelineno-4-42></a>
</span><span id=__span-4-43><a id=__codelineno-4-43 name=__codelineno-4-43 href=#__codelineno-4-43></a><span class=n>Xtr</span><span class=p>,</span> <span class=n>Xte</span><span class=p>,</span> <span class=n>ytr</span><span class=p>,</span> <span class=n>yte</span> <span class=o>=</span> <span class=n>train_test_split</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>test_size</span><span class=o>=</span><span class=mf>0.2</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>7</span><span class=p>)</span>
</span><span id=__span-4-44><a id=__codelineno-4-44 name=__codelineno-4-44 href=#__codelineno-4-44></a><span class=n>ytr_oh</span> <span class=o>=</span> <span class=n>one_hot</span><span class=p>(</span><span class=n>ytr</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span><span id=__span-4-45><a id=__codelineno-4-45 name=__codelineno-4-45 href=#__codelineno-4-45></a>
</span><span id=__span-4-46><a id=__codelineno-4-46 name=__codelineno-4-46 href=#__codelineno-4-46></a><span class=n>pca</span> <span class=o>=</span> <span class=n>PCA</span><span class=p>(</span><span class=n>n_components</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=mi>7</span><span class=p>)</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>X</span><span class=p>)</span>
</span><span id=__span-4-47><a id=__codelineno-4-47 name=__codelineno-4-47 href=#__codelineno-4-47></a><span class=n>X2</span> <span class=o>=</span> <span class=n>pca</span><span class=o>.</span><span class=n>transform</span><span class=p>(</span><span class=n>X</span><span class=p>)</span>
</span></code></pre></div> <p>Here is the data distribution plot after the PCA:</p> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/ex3-data-pca.png data-desc-position=bottom><img alt="Exercise 3" src=../images/ex3-data-pca.png></a></p> <h3 id=2-mlp-changes>2. MLP changes</h3> <p>We need to make slight changes to the Dense and MLP classes previously implemented, now supporting softmax and cross-entropy loss for multiclass classification. Here is the new Dense class, now supporting all the mentioned activations:</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=k>def</span><span class=w> </span><span class=nf>tanh</span><span class=p>(</span><span class=n>z</span><span class=p>):</span>      
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>tanh</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=k>def</span><span class=w> </span><span class=nf>dtanh</span><span class=p>(</span><span class=n>z</span><span class=p>):</span>     
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    <span class=n>a</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>tanh</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    <span class=k>return</span> <span class=mf>1.0</span> <span class=o>-</span> <span class=n>a</span><span class=o>*</span><span class=n>a</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=k>def</span><span class=w> </span><span class=nf>sigmoid</span><span class=p>(</span><span class=n>z</span><span class=p>):</span>   
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>    <span class=k>return</span> <span class=mf>1.0</span> <span class=o>/</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=o>-</span><span class=n>z</span><span class=p>))</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=k>def</span><span class=w> </span><span class=nf>softmax</span><span class=p>(</span><span class=n>z</span><span class=p>):</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>    <span class=n>zmax</span> <span class=o>=</span> <span class=n>z</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>keepdims</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>    <span class=n>e</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=n>z</span> <span class=o>-</span> <span class=n>zmax</span><span class=p>)</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>    <span class=k>return</span> <span class=n>e</span> <span class=o>/</span> <span class=n>e</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>keepdims</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=k>class</span><span class=w> </span><span class=nc>Dense</span><span class=p>:</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>in_dim</span><span class=p>,</span> <span class=n>out_dim</span><span class=p>,</span> <span class=n>activation</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>        <span class=bp>self</span><span class=o>.</span><span class=n>in_dim</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>out_dim</span> <span class=o>=</span> <span class=n>in_dim</span><span class=p>,</span> <span class=n>out_dim</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>        <span class=n>rng</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>default_rng</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a>        <span class=n>std</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mf>1.0</span> <span class=o>/</span> <span class=n>in_dim</span><span class=p>)</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>        <span class=bp>self</span><span class=o>.</span><span class=n>W</span> <span class=o>=</span> <span class=n>rng</span><span class=o>.</span><span class=n>normal</span><span class=p>(</span><span class=n>scale</span><span class=o>=</span><span class=n>std</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>in_dim</span><span class=p>,</span> <span class=n>out_dim</span><span class=p>))</span>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>        <span class=bp>self</span><span class=o>.</span><span class=n>b</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>out_dim</span><span class=p>)</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a>        <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>=</span> <span class=n>activation</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a>    <span class=k>def</span><span class=w> </span><span class=nf>_act</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>z</span><span class=p>):</span>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>         
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a>            <span class=k>return</span> <span class=n>z</span>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>==</span> <span class=s2>"tanh"</span><span class=p>:</span>       
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a>            <span class=k>return</span> <span class=n>tanh</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>==</span> <span class=s2>"sigmoid"</span><span class=p>:</span>    
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a>            <span class=k>return</span> <span class=n>sigmoid</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>==</span> <span class=s2>"softmax"</span><span class=p>:</span>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a>            <span class=k>return</span> <span class=n>softmax</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-5-32><a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>"unknown activation </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>activation</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</span><span id=__span-5-33><a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a>
</span><span id=__span-5-34><a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a>    <span class=k>def</span><span class=w> </span><span class=nf>_dact</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>z</span><span class=p>):</span>
</span><span id=__span-5-35><a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>         
</span><span id=__span-5-36><a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a>            <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>ones_like</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-5-37><a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>==</span> <span class=s2>"tanh"</span><span class=p>:</span>       
</span><span id=__span-5-38><a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a>            <span class=k>return</span> <span class=n>dtanh</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-5-39><a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>==</span> <span class=s2>"sigmoid"</span><span class=p>:</span>
</span><span id=__span-5-40><a id=__codelineno-5-40 name=__codelineno-5-40 href=#__codelineno-5-40></a>            <span class=n>s</span> <span class=o>=</span> <span class=n>sigmoid</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-5-41><a id=__codelineno-5-41 name=__codelineno-5-41 href=#__codelineno-5-41></a>            <span class=k>return</span> <span class=n>s</span><span class=o>*</span><span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>s</span><span class=p>)</span>
</span><span id=__span-5-42><a id=__codelineno-5-42 name=__codelineno-5-42 href=#__codelineno-5-42></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>==</span> <span class=s2>"softmax"</span><span class=p>:</span>
</span><span id=__span-5-43><a id=__codelineno-5-43 name=__codelineno-5-43 href=#__codelineno-5-43></a>            <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-5-44><a id=__codelineno-5-44 name=__codelineno-5-44 href=#__codelineno-5-44></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>"unknown activation </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>activation</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</span><span id=__span-5-45><a id=__codelineno-5-45 name=__codelineno-5-45 href=#__codelineno-5-45></a>
</span><span id=__span-5-46><a id=__codelineno-5-46 name=__codelineno-5-46 href=#__codelineno-5-46></a>    <span class=k>def</span><span class=w> </span><span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>X</span><span class=p>):</span>
</span><span id=__span-5-47><a id=__codelineno-5-47 name=__codelineno-5-47 href=#__codelineno-5-47></a>        <span class=n>Z</span> <span class=o>=</span> <span class=n>X</span> <span class=o>@</span> <span class=bp>self</span><span class=o>.</span><span class=n>W</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>b</span>
</span><span id=__span-5-48><a id=__codelineno-5-48 name=__codelineno-5-48 href=#__codelineno-5-48></a>        <span class=n>A</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_act</span><span class=p>(</span><span class=n>Z</span><span class=p>)</span>
</span><span id=__span-5-49><a id=__codelineno-5-49 name=__codelineno-5-49 href=#__codelineno-5-49></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=s2>"X"</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=s2>"Z"</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=s2>"A"</span><span class=p>]</span> <span class=o>=</span> <span class=n>X</span><span class=p>,</span> <span class=n>Z</span><span class=p>,</span> <span class=n>A</span>
</span><span id=__span-5-50><a id=__codelineno-5-50 name=__codelineno-5-50 href=#__codelineno-5-50></a>        <span class=k>return</span> <span class=n>A</span>
</span><span id=__span-5-51><a id=__codelineno-5-51 name=__codelineno-5-51 href=#__codelineno-5-51></a>
</span><span id=__span-5-52><a id=__codelineno-5-52 name=__codelineno-5-52 href=#__codelineno-5-52></a>    <span class=k>def</span><span class=w> </span><span class=nf>backward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dA</span><span class=p>,</span> <span class=n>lr</span><span class=p>):</span>
</span><span id=__span-5-53><a id=__codelineno-5-53 name=__codelineno-5-53 href=#__codelineno-5-53></a>        <span class=n>X</span><span class=p>,</span> <span class=n>Z</span><span class=p>,</span> <span class=n>A</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=s2>"X"</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=s2>"Z"</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>_cache</span><span class=p>[</span><span class=s2>"A"</span><span class=p>]</span>
</span><span id=__span-5-54><a id=__codelineno-5-54 name=__codelineno-5-54 href=#__codelineno-5-54></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>==</span> <span class=s2>"softmax"</span><span class=p>:</span>
</span><span id=__span-5-55><a id=__codelineno-5-55 name=__codelineno-5-55 href=#__codelineno-5-55></a>            <span class=n>dZ</span> <span class=o>=</span> <span class=n>dA</span>
</span><span id=__span-5-56><a id=__codelineno-5-56 name=__codelineno-5-56 href=#__codelineno-5-56></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-5-57><a id=__codelineno-5-57 name=__codelineno-5-57 href=#__codelineno-5-57></a>            <span class=n>dZ</span> <span class=o>=</span> <span class=n>dA</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>_dact</span><span class=p>(</span><span class=n>Z</span><span class=p>)</span>
</span><span id=__span-5-58><a id=__codelineno-5-58 name=__codelineno-5-58 href=#__codelineno-5-58></a>        <span class=n>dW</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>T</span> <span class=o>@</span> <span class=n>dZ</span> <span class=o>/</span> <span class=n>X</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-5-59><a id=__codelineno-5-59 name=__codelineno-5-59 href=#__codelineno-5-59></a>        <span class=n>db</span> <span class=o>=</span> <span class=n>dZ</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-5-60><a id=__codelineno-5-60 name=__codelineno-5-60 href=#__codelineno-5-60></a>        <span class=n>dX</span> <span class=o>=</span> <span class=n>dZ</span> <span class=o>@</span> <span class=bp>self</span><span class=o>.</span><span class=n>W</span><span class=o>.</span><span class=n>T</span>
</span><span id=__span-5-61><a id=__codelineno-5-61 name=__codelineno-5-61 href=#__codelineno-5-61></a>        <span class=bp>self</span><span class=o>.</span><span class=n>W</span> <span class=o>-=</span> <span class=n>lr</span> <span class=o>*</span> <span class=n>dW</span>
</span><span id=__span-5-62><a id=__codelineno-5-62 name=__codelineno-5-62 href=#__codelineno-5-62></a>        <span class=bp>self</span><span class=o>.</span><span class=n>b</span> <span class=o>-=</span> <span class=n>lr</span> <span class=o>*</span> <span class=n>db</span>
</span><span id=__span-5-63><a id=__codelineno-5-63 name=__codelineno-5-63 href=#__codelineno-5-63></a>        <span class=k>return</span> <span class=n>dX</span>
</span></code></pre></div> <p>And here is the new MLP class, now supporting softmax and cross-entropy loss for multiclass classification:</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=k>class</span><span class=w> </span><span class=nc>MLP</span><span class=p>:</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>layer_dims</span><span class=p>,</span> <span class=n>hidden_activation</span><span class=o>=</span><span class=s2>"tanh"</span><span class=p>,</span> <span class=n>multiclass</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>layers</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>multiclass</span> <span class=o>=</span> <span class=n>multiclass</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>        <span class=n>rng</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>default_rng</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>layer_dims</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>):</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>            <span class=n>act</span> <span class=o>=</span> <span class=n>hidden_activation</span> <span class=k>if</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>layer_dims</span><span class=p>)</span> <span class=o>-</span> <span class=mi>2</span> <span class=k>else</span> <span class=p>(</span><span class=s2>"softmax"</span> <span class=k>if</span> <span class=n>multiclass</span> <span class=k>else</span> <span class=kc>None</span><span class=p>)</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>            <span class=bp>self</span><span class=o>.</span><span class=n>layers</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>                <span class=n>Dense</span><span class=p>(</span><span class=n>layer_dims</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>layer_dims</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>],</span> <span class=n>activation</span><span class=o>=</span><span class=n>act</span><span class=p>,</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>                      <span class=n>seed</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>rng</span><span class=o>.</span><span class=n>integers</span><span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>30</span><span class=p>)))</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>            <span class=p>)</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>    <span class=k>def</span><span class=w> </span><span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>X</span><span class=p>):</span>
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>        <span class=n>A</span> <span class=o>=</span> <span class=n>X</span>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a>        <span class=k>for</span> <span class=n>lyr</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>layers</span><span class=p>:</span>
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>            <span class=n>A</span> <span class=o>=</span> <span class=n>lyr</span><span class=o>.</span><span class=n>forward</span><span class=p>(</span><span class=n>A</span><span class=p>)</span>
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>        <span class=k>return</span> <span class=n>A</span>
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a>    <span class=k>def</span><span class=w> </span><span class=nf>_softmax_ce_and_grad</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>P</span><span class=p>,</span> <span class=n>Y_onehot</span><span class=p>):</span>
</span><span id=__span-6-21><a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a>        <span class=n>eps</span> <span class=o>=</span> <span class=mf>1e-12</span>
</span><span id=__span-6-22><a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a>        <span class=n>P</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>clip</span><span class=p>(</span><span class=n>P</span><span class=p>,</span> <span class=n>eps</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>)</span>
</span><span id=__span-6-23><a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a>        <span class=n>loss</span> <span class=o>=</span> <span class=o>-</span><span class=p>(</span><span class=n>Y_onehot</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>P</span><span class=p>))</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-6-24><a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a>        <span class=n>dZ</span> <span class=o>=</span> <span class=p>(</span><span class=n>P</span> <span class=o>-</span> <span class=n>Y_onehot</span><span class=p>)</span>
</span><span id=__span-6-25><a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a>        <span class=k>return</span> <span class=nb>float</span><span class=p>(</span><span class=n>loss</span><span class=p>),</span> <span class=n>dZ</span>
</span><span id=__span-6-26><a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a>
</span><span id=__span-6-27><a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a>    <span class=k>def</span><span class=w> </span><span class=nf>fit</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>y_onehot</span><span class=p>,</span> <span class=n>epochs</span><span class=o>=</span><span class=mi>300</span><span class=p>,</span> <span class=n>lr</span><span class=o>=</span><span class=mf>1e-1</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=mi>64</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>verbose</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span><span id=__span-6-28><a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a>        <span class=n>rng</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>default_rng</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span><span id=__span-6-29><a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a>        <span class=n>n</span> <span class=o>=</span> <span class=n>X</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-6-30><a id=__codelineno-6-30 name=__codelineno-6-30 href=#__codelineno-6-30></a>        <span class=n>hist</span> <span class=o>=</span> <span class=p>{</span><span class=s2>"loss"</span><span class=p>:</span> <span class=p>[]}</span>
</span><span id=__span-6-31><a id=__codelineno-6-31 name=__codelineno-6-31 href=#__codelineno-6-31></a>
</span><span id=__span-6-32><a id=__codelineno-6-32 name=__codelineno-6-32 href=#__codelineno-6-32></a>        <span class=k>for</span> <span class=n>ep</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>epochs</span><span class=p>):</span>
</span><span id=__span-6-33><a id=__codelineno-6-33 name=__codelineno-6-33 href=#__codelineno-6-33></a>            <span class=n>idx</span> <span class=o>=</span> <span class=n>rng</span><span class=o>.</span><span class=n>permutation</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span><span id=__span-6-34><a id=__codelineno-6-34 name=__codelineno-6-34 href=#__codelineno-6-34></a>            <span class=n>Xs</span><span class=p>,</span> <span class=n>ys</span> <span class=o>=</span> <span class=n>X</span><span class=p>[</span><span class=n>idx</span><span class=p>],</span> <span class=n>y_onehot</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
</span><span id=__span-6-35><a id=__codelineno-6-35 name=__codelineno-6-35 href=#__codelineno-6-35></a>            <span class=n>ep_losses</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-6-36><a id=__codelineno-6-36 name=__codelineno-6-36 href=#__codelineno-6-36></a>
</span><span id=__span-6-37><a id=__codelineno-6-37 name=__codelineno-6-37 href=#__codelineno-6-37></a>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>):</span>
</span><span id=__span-6-38><a id=__codelineno-6-38 name=__codelineno-6-38 href=#__codelineno-6-38></a>                <span class=n>xb</span> <span class=o>=</span> <span class=n>Xs</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=n>batch_size</span><span class=p>]</span>
</span><span id=__span-6-39><a id=__codelineno-6-39 name=__codelineno-6-39 href=#__codelineno-6-39></a>                <span class=n>yb</span> <span class=o>=</span> <span class=n>ys</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=n>batch_size</span><span class=p>]</span>
</span><span id=__span-6-40><a id=__codelineno-6-40 name=__codelineno-6-40 href=#__codelineno-6-40></a>
</span><span id=__span-6-41><a id=__codelineno-6-41 name=__codelineno-6-41 href=#__codelineno-6-41></a>                <span class=n>P</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>forward</span><span class=p>(</span><span class=n>xb</span><span class=p>)</span>        
</span><span id=__span-6-42><a id=__codelineno-6-42 name=__codelineno-6-42 href=#__codelineno-6-42></a>                <span class=n>loss</span><span class=p>,</span> <span class=n>dZlast</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_softmax_ce_and_grad</span><span class=p>(</span><span class=n>P</span><span class=p>,</span> <span class=n>yb</span><span class=p>)</span>
</span><span id=__span-6-43><a id=__codelineno-6-43 name=__codelineno-6-43 href=#__codelineno-6-43></a>                <span class=n>ep_losses</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>loss</span><span class=p>)</span>
</span><span id=__span-6-44><a id=__codelineno-6-44 name=__codelineno-6-44 href=#__codelineno-6-44></a>
</span><span id=__span-6-45><a id=__codelineno-6-45 name=__codelineno-6-45 href=#__codelineno-6-45></a>                <span class=n>dA</span> <span class=o>=</span> <span class=n>dZlast</span>
</span><span id=__span-6-46><a id=__codelineno-6-46 name=__codelineno-6-46 href=#__codelineno-6-46></a>                <span class=k>for</span> <span class=n>lyr</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>layers</span><span class=p>):</span>
</span><span id=__span-6-47><a id=__codelineno-6-47 name=__codelineno-6-47 href=#__codelineno-6-47></a>                    <span class=n>dA</span> <span class=o>=</span> <span class=n>lyr</span><span class=o>.</span><span class=n>backward</span><span class=p>(</span><span class=n>dA</span><span class=p>,</span> <span class=n>lr</span><span class=p>)</span>
</span><span id=__span-6-48><a id=__codelineno-6-48 name=__codelineno-6-48 href=#__codelineno-6-48></a>
</span><span id=__span-6-49><a id=__codelineno-6-49 name=__codelineno-6-49 href=#__codelineno-6-49></a>            <span class=n>hist</span><span class=p>[</span><span class=s2>"loss"</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>(</span><span class=n>ep_losses</span><span class=p>))</span>
</span><span id=__span-6-50><a id=__codelineno-6-50 name=__codelineno-6-50 href=#__codelineno-6-50></a>            <span class=k>if</span> <span class=n>verbose</span> <span class=ow>and</span> <span class=p>(</span><span class=n>ep</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=mi>25</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-6-51><a id=__codelineno-6-51 name=__codelineno-6-51 href=#__codelineno-6-51></a>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>"epoch </span><span class=si>{</span><span class=n>ep</span><span class=o>+</span><span class=mi>1</span><span class=si>:</span><span class=s2>3d</span><span class=si>}</span><span class=s2>: loss=</span><span class=si>{</span><span class=n>hist</span><span class=p>[</span><span class=s1>'loss'</span><span class=p>][</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</span><span id=__span-6-52><a id=__codelineno-6-52 name=__codelineno-6-52 href=#__codelineno-6-52></a>        <span class=k>return</span> <span class=n>hist</span>
</span><span id=__span-6-53><a id=__codelineno-6-53 name=__codelineno-6-53 href=#__codelineno-6-53></a>
</span><span id=__span-6-54><a id=__codelineno-6-54 name=__codelineno-6-54 href=#__codelineno-6-54></a>    <span class=k>def</span><span class=w> </span><span class=nf>predict</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>X</span><span class=p>):</span>
</span><span id=__span-6-55><a id=__codelineno-6-55 name=__codelineno-6-55 href=#__codelineno-6-55></a>        <span class=n>P</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>forward</span><span class=p>(</span><span class=n>X</span><span class=p>)</span>
</span><span id=__span-6-56><a id=__codelineno-6-56 name=__codelineno-6-56 href=#__codelineno-6-56></a>        <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>argmax</span><span class=p>(</span><span class=n>P</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></code></pre></div> <h3 id=3-training-and-results_1>3. Training and results</h3> <p>Finally, we train the MLP in the generated dataset with the following code:</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>mlp3</span> <span class=o>=</span> <span class=n>MLP</span><span class=p>(</span><span class=n>layer_dims</span><span class=o>=</span><span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=n>hidden_activation</span><span class=o>=</span><span class=s2>"tanh"</span><span class=p>,</span> <span class=n>multiclass</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>7</span><span class=p>)</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=n>hist3</span> <span class=o>=</span> <span class=n>mlp3</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>Xtr</span><span class=p>,</span> <span class=n>one_hot</span><span class=p>(</span><span class=n>ytr</span><span class=p>,</span> <span class=mi>3</span><span class=p>),</span> <span class=n>epochs</span><span class=o>=</span><span class=mi>500</span><span class=p>,</span> <span class=n>lr</span><span class=o>=</span><span class=mf>1e-1</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=mi>64</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>verbose</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></code></pre></div> <p>We get the following training loss plot:</p> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/ex3-loss.png data-desc-position=bottom><img alt="Exercise 3" src=../images/ex3-loss.png></a></p> <p>In this test with 500 epochs, we got a test accuracy of 0.9600.</p> <p>The confusion matrix is:</p> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/ex3-confusion.png data-desc-position=bottom><img alt="Exercise 3" src=../images/ex3-confusion.png></a></p> <h2 id=exercise-4-deeper-mlp-on-multiclass-dataset>Exercise 4 — Deeper MLP on multiclass dataset</h2> <p>We will now use a generated multiclass dataset, with the same code and parameters as the previous exercise, but now with a deeper MLP. For this exercise, we will use a MLP with 3 hidden layers, with 64, 64 and 32 neurons, respectively, and tanh activations. We will skip the data preparation step as it is the same as the previous exercise. Here is the 2D PCA plot of the train data:</p> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/ex4-data-pca-train.png data-desc-position=bottom><img alt="Exercise 4" src=../images/ex4-data-pca-train.png></a></p> <p>No changes are needed to the MLP class, as it is already supporting softmax and cross-entropy loss for multiclass classification, and multiple hidden layers with selectable number of neurons.</p> <p>We train the MLP with the following code:</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=n>mlp4</span> <span class=o>=</span> <span class=n>MLP</span><span class=p>(</span><span class=n>layer_dims</span><span class=o>=</span><span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=n>hidden_activation</span><span class=o>=</span><span class=s2>"tanh"</span><span class=p>,</span> <span class=n>multiclass</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>11</span><span class=p>)</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=n>hist4</span> <span class=o>=</span> <span class=n>mlp4</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>Xtr</span><span class=p>,</span> <span class=n>ytr_oh</span><span class=p>,</span> <span class=n>epochs</span><span class=o>=</span><span class=mi>500</span><span class=p>,</span> <span class=n>lr</span><span class=o>=</span><span class=mf>1e-1</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=mi>64</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>verbose</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></code></pre></div> <p>We get the following training loss plot:</p> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/ex4-loss.png data-desc-position=bottom><img alt="Exercise 4" src=../images/ex4-loss.png></a></p> <p>In this test with 500 epochs, we got a test accuracy of 0.9633.</p> <p>The confusion matrix is:</p> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/ex4-confusion.png data-desc-position=bottom><img alt="Exercise 4" src=../images/ex4-confusion.png></a></p> <p>The deeper MLP with two hidden layers achieved slightly better accuracy compared to the single hidden layer MLP from Exercise 3. However, the improvement was modest, as the one hidden layer architecture already performed very well. This shows that for relatively simple synthetic tasks, increasing depth may not yield significant gains, though it can provide small improvements in stability and performance.</p> <hr> <p><em>Note</em>: Artificial intelligence was used in this exercise for code completion and review, for translating math formulas to Latex, and for text review.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="September 25, 2025 03:08:16 UTC">September 25, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="September 25, 2025 02:59:50 UTC">September 25, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Contributors> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"></path></svg> </span> <nav> <a href=mailto:thomaschiari@gmail.com>thomaschiari</a> </nav> </span> <span class=md-source-file__fact> <span class=md-icon title=Contributors> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path></svg> </span> <span>GitHub</span> <nav> <a href=https://github.com/thomaschiari class=md-author title=@thomaschiari> <img src="https://avatars.githubusercontent.com/u/73441789?v=4&size=72" alt=thomaschiari> </a> </nav> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate", "content.tooltips", "navigation.instant", "navigation.instant.progress", "navigation.top", "navigation.path", "navigation.tracking", "navigation.expand"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.92b07e13.min.js></script> <script src=../../assets/_markdown_exec_pyodide.js></script> <script src=https://unpkg.com/mathjax/es5/tex-mml-chtml.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=https://fastly.jsdelivr.net/npm/jquery/dist/jquery.min.js></script> <script src=https://fastly.jsdelivr.net/npm/echarts/dist/echarts.min.js></script> <script src=../../assets/javascripts/badge.js async></script> <script src=../../termynal.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>