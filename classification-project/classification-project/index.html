<!DOCTYPE html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Thomas Chiari Ciocchetti de Souza"><link href=https://thomaschiari.github.io/deep-learning-coursework/classification-project/classification-project/ rel=canonical><link href=../../mlp/mlp-exercise/ rel=prev><link href=../../vae/vae-exercise/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.0"><title>Classification Project - Deep Learning Coursework</title><link rel=stylesheet href=../../assets/stylesheets/main.618322db.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M64%20480c-35.3%200-64-28.7-64-64V96c0-35.3%2028.7-64%2064-64h320c35.3%200%2064%2028.7%2064%2064v213.5c0%2017-6.7%2033.3-18.7%2045.3L322.7%20461.3c-12%2012-28.3%2018.7-45.3%2018.7zm325.5-176H296c-13.3%200-24%2010.7-24%2024v93.5z%22/%3E%3C/svg%3E');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M384%20512H96c-53%200-96-43-96-96V96C0%2043%2043%200%2096%200h304c26.5%200%2048%2021.5%2048%2048v288c0%2020.9-13.4%2038.7-32%2045.3V448c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032zM96%20384c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032h256v-64zm32-232c0%2013.3%2010.7%2024%2024%2024h176c13.3%200%2024-10.7%2024-24s-10.7-24-24-24H152c-13.3%200-24%2010.7-24%2024m24%2072c-13.3%200-24%2010.7-24%2024s10.7%2024%2024%2024h176c13.3%200%2024-10.7%2024-24s-10.7-24-24-24z%22/%3E%3C/svg%3E');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m-32-352a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200m-8%2064h48c13.3%200%2024%2010.7%2024%2024v88h8c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-80c-13.3%200-24-10.7-24-24s10.7-24%2024-24h24v-64h-24c-13.3%200-24-10.7-24-24s10.7-24%2024-24%22/%3E%3C/svg%3E');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M461.2%2018.9C472.7%2024%20480%2035.4%20480%2048v416c0%2012.6-7.3%2024-18.8%2029.1s-24.8%203.2-34.3-5.1l-46.6-40.7c-43.6-38.1-98.7-60.3-156.4-63V480c0%2017.7-14.3%2032-32%2032h-32c-17.7%200-32-14.3-32-32v-96C57.3%20384%200%20326.7%200%20256s57.3-128%20128-128h84.5c61.8-.2%20121.4-22.7%20167.9-63.3L427%2024c9.4-8.3%2022.9-10.2%2034.3-5.1zM224%20320v.2c70.3%202.7%20137.8%2028.5%20192%2073.4V118.3c-54.2%2044.9-121.7%2070.7-192%2073.4z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M434.8%2070.1c14.3%2010.4%2017.5%2030.4%207.1%2044.7l-256%20352c-5.5%207.6-14%2012.3-23.4%2013.1s-18.5-2.7-25.1-9.3l-128-128c-12.5-12.5-12.5-32.8%200-45.3s32.8-12.5%2045.3%200l101.5%20101.5%20234-321.7c10.4-14.3%2030.4-17.5%2044.7-7.1z%22/%3E%3C/svg%3E');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%20512a256%20256%200%201%200%200-512%20256%20256%200%201%200%200%20512m0-336c-17.7%200-32%2014.3-32%2032%200%2013.3-10.7%2024-24%2024s-24-10.7-24-24c0-44.2%2035.8-80%2080-80s80%2035.8%2080%2080c0%2047.2-36%2067.2-56%2074.5v3.8c0%2013.3-10.7%2024-24%2024s-24-10.7-24-24v-8.1c0-20.5%2014.8-35.2%2030.1-40.2%206.4-2.1%2013.2-5.5%2018.2-10.3%204.3-4.2%207.7-10%207.7-19.6%200-17.7-14.3-32-32-32zm-32%20192a32%2032%200%201%201%2064%200%2032%2032%200%201%201-64%200%22/%3E%3C/svg%3E');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M256%200c14.7%200%2028.2%208.1%2035.2%2021l216%20400c6.7%2012.4%206.4%2027.4-.8%2039.5S486.1%20480%20472%20480H40c-14.1%200-27.2-7.4-34.4-19.5s-7.5-27.1-.8-39.5l216-400c7-12.9%2020.5-21%2035.2-21m0%20352a32%2032%200%201%200%200%2064%2032%2032%200%201%200%200-64m0-192c-18.2%200-32.7%2015.5-31.4%2033.7l7.4%20104c.9%2012.5%2011.4%2022.3%2023.9%2022.3%2012.6%200%2023-9.7%2023.9-22.3l7.4-104c1.3-18.2-13.1-33.7-31.4-33.7z%22/%3E%3C/svg%3E');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20576%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M480-16c6.9%200%2013%204.4%2015.2%2010.9l13.5%2040.4%2040.4%2013.5C555.6%2051%20560%2057.1%20560%2064s-4.4%2013-10.9%2015.2l-40.4%2013.5-13.5%2040.4c-2.2%206.5-8.3%2010.9-15.2%2010.9s-13-4.4-15.2-10.9l-13.5-40.4-40.4-13.5C404.4%2077%20400%2070.9%20400%2064s4.4-13%2010.9-15.2l40.4-13.5%2013.5-40.4C467-11.6%20473.1-16%20480-16M321.4%2097.4c12.5-12.5%2032.8-12.5%2045.3%200l80%2080c12.5%2012.5%2012.5%2032.8%200%2045.3l-10.9%2010.9c7.9%2022%2012.2%2045.7%2012.2%2070.5%200%20114.9-93.1%20208-208%20208S32%20418.9%2032%20304%20125.1%2096%20240%2096c24.7%200%2048.5%204.3%2070.5%2012.3zM144%20304c0-53%2043-96%2096-96%2013.3%200%2024-10.7%2024-24s-10.7-24-24-24c-79.5%200-144%2064.5-144%20144%200%2013.3%2010.7%2024%2024%2024s24-10.7%2024-24%22/%3E%3C/svg%3E');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20512%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M416%20427.4c58.5-44%2096-111.6%2096-187.4C512%20107.5%20397.4%200%20256%200S0%20107.5%200%20240c0%2075.8%2037.5%20143.4%2096%20187.4V464c0%2026.5%2021.5%2048%2048%2048h32v-40c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v40h64v-40c0-13.3%2010.7-24%2024-24s24%2010.7%2024%2024v40h32c26.5%200%2048-21.5%2048-48zM96%20256a64%2064%200%201%201%20128%200%2064%2064%200%201%201-128%200m256-64a64%2064%200%201%201%200%20128%2064%2064%200%201%201%200-128%22/%3E%3C/svg%3E');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20640%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M352%200c0-17.7-14.3-32-32-32s-32%2014.3-32%2032v64h-96c-53%200-96%2043-96%2096v224c0%2053%2043%2096%2096%2096h256c53%200%2096-43%2096-96V160c0-53-43-96-96-96h-96zM160%20368c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24m120%200c0-13.3%2010.7-24%2024-24h32c13.3%200%2024%2010.7%2024%2024s-10.7%2024-24%2024h-32c-13.3%200-24-10.7-24-24M224%20176a48%2048%200%201%201%200%2096%2048%2048%200%201%201%200-96m144%2048a48%2048%200%201%201%2096%200%2048%2048%200%201%201-96%200m-304%200c0-17.7-14.3-32-32-32S0%20206.3%200%20224v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32zm544-32c-17.7%200-32%2014.3-32%2032v96c0%2017.7%2014.3%2032%2032%2032s32-14.3%2032-32v-96c0-17.7-14.3-32-32-32%22/%3E%3C/svg%3E');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M288%200H128c-17.7%200-32%2014.3-32%2032s14.3%2032%2032%2032v151.5L7.5%20426.3C2.6%20435%200%20444.7%200%20454.7%200%20486.4%2025.6%20512%2057.3%20512h333.4c31.6%200%2057.3-25.6%2057.3-57.3%200-10-2.6-19.8-7.5-28.4L320%20215.5V64c17.7%200%2032-14.3%2032-32S337.7%200%20320%200zm-96%20215.5V64h64v151.5c0%2011.1%202.9%2022.1%208.4%2031.8L306%20320H142l41.6-72.7c5.5-9.7%208.4-20.6%208.4-31.8%22/%3E%3C/svg%3E');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%20448%20512%22%3E%3C%21--%21%20Font%20Awesome%20Free%207.1.0%20by%20%40fontawesome%20-%20https%3A//fontawesome.com%20License%20-%20https%3A//fontawesome.com/license/free%20%28Icons%3A%20CC%20BY%204.0%2C%20Fonts%3A%20SIL%20OFL%201.1%2C%20Code%3A%20MIT%20License%29%20Copyright%202025%20Fonticons%2C%20Inc.--%3E%3Cpath%20d%3D%22M0%20216C0%20149.7%2053.7%2096%20120%2096h8c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032h-8c-30.9%200-56%2025.1-56%2056v8h64c35.3%200%2064%2028.7%2064%2064v64c0%2035.3-28.7%2064-64%2064H64c-35.3%200-64-28.7-64-64zm256%200c0-66.3%2053.7-120%20120-120h8c17.7%200%2032%2014.3%2032%2032s-14.3%2032-32%2032h-8c-30.9%200-56%2025.1-56%2056v8h64c35.3%200%2064%2028.7%2064%2064v64c0%2035.3-28.7%2064-64%2064h-64c-35.3%200-64-28.7-64-64z%22/%3E%3C/svg%3E');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_markdown_exec_pyodide.css><link rel=stylesheet href=../../assets/_markdown_exec_ansi.css><link rel=stylesheet href=../../assets/stylesheets/badge.css><link rel=stylesheet href=../../termynal.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../assets/stylesheets/glightbox.min.css rel=stylesheet><script src=../../assets/javascripts/glightbox.min.js></script><style id=glightbox-style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=grey data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#classification-project class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Deep Learning Coursework" class="md-header__button md-logo" aria-label="Deep Learning Coursework" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Deep Learning Coursework </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Classification Project </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=grey data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"></path></svg> </label> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=grey data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"></path></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=grey data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_3 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"></path></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=grey data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_3> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/thomaschiari/deep-learning-coursework title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class=md-source__repository> github/deep-learning-coursework </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Deep Learning Coursework" class="md-nav__button md-logo" aria-label="Deep Learning Coursework" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> Deep Learning Coursework </label> <div class=md-nav__source> <a href=https://github.com/thomaschiari/deep-learning-coursework title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class=md-source__repository> github/deep-learning-coursework </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../data/data_exercise/ class=md-nav__link> <span class=md-ellipsis> Data Task </span> </a> </li> <li class=md-nav__item> <a href=../../perceptron/perceptron-exercise/ class=md-nav__link> <span class=md-ellipsis> Perceptron Task </span> </a> </li> <li class=md-nav__item> <a href=../../mlp/mlp-exercise/ class=md-nav__link> <span class=md-ellipsis> MLP Task </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Classification Project </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Classification Project </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-dataset-selection class=md-nav__link> <span class=md-ellipsis> 1. Dataset Selection </span> </a> </li> <li class=md-nav__item> <a href=#2-dataset-explanation class=md-nav__link> <span class=md-ellipsis> 2. Dataset Explanation </span> </a> </li> <li class=md-nav__item> <a href=#3-data-preprocessing class=md-nav__link> <span class=md-ellipsis> 3. Data Preprocessing </span> </a> <nav class=md-nav aria-label="3. Data Preprocessing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#treating-missing-values-and-duplicates class=md-nav__link> <span class=md-ellipsis> Treating missing values and duplicates </span> </a> </li> <li class=md-nav__item> <a href=#scaling-numerical-features class=md-nav__link> <span class=md-ellipsis> Scaling numerical features </span> </a> </li> <li class=md-nav__item> <a href=#encoding-categorical-features class=md-nav__link> <span class=md-ellipsis> Encoding categorical features </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-mlp-implementation class=md-nav__link> <span class=md-ellipsis> 4. MLP Implementation </span> </a> <nav class=md-nav aria-label="4. MLP Implementation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hyperparameters class=md-nav__link> <span class=md-ellipsis> Hyperparameters </span> </a> </li> <li class=md-nav__item> <a href=#architecture class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=#activation-functions class=md-nav__link> <span class=md-ellipsis> Activation functions </span> </a> </li> <li class=md-nav__item> <a href=#loss-function class=md-nav__link> <span class=md-ellipsis> Loss function </span> </a> </li> <li class=md-nav__item> <a href=#optimizer class=md-nav__link> <span class=md-ellipsis> Optimizer </span> </a> </li> <li class=md-nav__item> <a href=#final-model-implementation class=md-nav__link> <span class=md-ellipsis> Final model implementation </span> </a> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-model-training class=md-nav__link> <span class=md-ellipsis> 5. Model Training </span> </a> </li> <li class=md-nav__item> <a href=#6-training-testing-strategy class=md-nav__link> <span class=md-ellipsis> 6. Training &amp; Testing Strategy </span> </a> </li> <li class=md-nav__item> <a href=#7-error-curves-and-visualization class=md-nav__link> <span class=md-ellipsis> 7. Error Curves and Visualization </span> </a> </li> <li class=md-nav__item> <a href=#8-evaluation-metrics class=md-nav__link> <span class=md-ellipsis> 8. Evaluation Metrics </span> </a> <nav class=md-nav aria-label="8. Evaluation Metrics"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#summary-metrics class=md-nav__link> <span class=md-ellipsis> Summary metrics: </span> </a> </li> <li class=md-nav__item> <a href=#confusion-matrix class=md-nav__link> <span class=md-ellipsis> Confusion Matrix </span> </a> </li> <li class=md-nav__item> <a href=#roc-curve class=md-nav__link> <span class=md-ellipsis> ROC Curve </span> </a> </li> <li class=md-nav__item> <a href=#precisionrecall-curve class=md-nav__link> <span class=md-ellipsis> Precision–Recall Curve </span> </a> </li> <li class=md-nav__item> <a href=#perclass-metrics class=md-nav__link> <span class=md-ellipsis> Per‑class metrics: </span> </a> </li> <li class=md-nav__item> <a href=#interpretation class=md-nav__link> <span class=md-ellipsis> Interpretation </span> </a> <nav class=md-nav aria-label=Interpretation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#class-0-majority class=md-nav__link> <span class=md-ellipsis> Class 0 (majority) </span> </a> </li> <li class=md-nav__item> <a href=#class-1-minority class=md-nav__link> <span class=md-ellipsis> Class 1 (minority) </span> </a> </li> <li class=md-nav__item> <a href=#macro-averages-unweighted class=md-nav__link> <span class=md-ellipsis> Macro averages (unweighted) </span> </a> </li> <li class=md-nav__item> <a href=#weighted-averages-by-class-frequency class=md-nav__link> <span class=md-ellipsis> Weighted averages (by class frequency) </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9-conclusion class=md-nav__link> <span class=md-ellipsis> 9. Conclusion </span> </a> <nav class=md-nav aria-label="9. Conclusion"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#submission-github-pages class=md-nav__link> <span class=md-ellipsis> Submission — GitHub Pages </span> </a> </li> <li class=md-nav__item> <a href=#academic-integrity-ai-collaboration class=md-nav__link> <span class=md-ellipsis> Academic Integrity &amp; AI Collaboration </span> </a> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> <span class=md-ellipsis> References </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../vae/vae-exercise/ class=md-nav__link> <span class=md-ellipsis> VAE Task </span> </a> </li> <li class=md-nav__item> <a href=../../regression-project/regression-project/ class=md-nav__link> <span class=md-ellipsis> Regression Project </span> </a> </li> <li class=md-nav__item> <a href=../../generative-project/generative-project/ class=md-nav__link> <span class=md-ellipsis> Generative Project </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#1-dataset-selection class=md-nav__link> <span class=md-ellipsis> 1. Dataset Selection </span> </a> </li> <li class=md-nav__item> <a href=#2-dataset-explanation class=md-nav__link> <span class=md-ellipsis> 2. Dataset Explanation </span> </a> </li> <li class=md-nav__item> <a href=#3-data-preprocessing class=md-nav__link> <span class=md-ellipsis> 3. Data Preprocessing </span> </a> <nav class=md-nav aria-label="3. Data Preprocessing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#treating-missing-values-and-duplicates class=md-nav__link> <span class=md-ellipsis> Treating missing values and duplicates </span> </a> </li> <li class=md-nav__item> <a href=#scaling-numerical-features class=md-nav__link> <span class=md-ellipsis> Scaling numerical features </span> </a> </li> <li class=md-nav__item> <a href=#encoding-categorical-features class=md-nav__link> <span class=md-ellipsis> Encoding categorical features </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-mlp-implementation class=md-nav__link> <span class=md-ellipsis> 4. MLP Implementation </span> </a> <nav class=md-nav aria-label="4. MLP Implementation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hyperparameters class=md-nav__link> <span class=md-ellipsis> Hyperparameters </span> </a> </li> <li class=md-nav__item> <a href=#architecture class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=#activation-functions class=md-nav__link> <span class=md-ellipsis> Activation functions </span> </a> </li> <li class=md-nav__item> <a href=#loss-function class=md-nav__link> <span class=md-ellipsis> Loss function </span> </a> </li> <li class=md-nav__item> <a href=#optimizer class=md-nav__link> <span class=md-ellipsis> Optimizer </span> </a> </li> <li class=md-nav__item> <a href=#final-model-implementation class=md-nav__link> <span class=md-ellipsis> Final model implementation </span> </a> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-model-training class=md-nav__link> <span class=md-ellipsis> 5. Model Training </span> </a> </li> <li class=md-nav__item> <a href=#6-training-testing-strategy class=md-nav__link> <span class=md-ellipsis> 6. Training &amp; Testing Strategy </span> </a> </li> <li class=md-nav__item> <a href=#7-error-curves-and-visualization class=md-nav__link> <span class=md-ellipsis> 7. Error Curves and Visualization </span> </a> </li> <li class=md-nav__item> <a href=#8-evaluation-metrics class=md-nav__link> <span class=md-ellipsis> 8. Evaluation Metrics </span> </a> <nav class=md-nav aria-label="8. Evaluation Metrics"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#summary-metrics class=md-nav__link> <span class=md-ellipsis> Summary metrics: </span> </a> </li> <li class=md-nav__item> <a href=#confusion-matrix class=md-nav__link> <span class=md-ellipsis> Confusion Matrix </span> </a> </li> <li class=md-nav__item> <a href=#roc-curve class=md-nav__link> <span class=md-ellipsis> ROC Curve </span> </a> </li> <li class=md-nav__item> <a href=#precisionrecall-curve class=md-nav__link> <span class=md-ellipsis> Precision–Recall Curve </span> </a> </li> <li class=md-nav__item> <a href=#perclass-metrics class=md-nav__link> <span class=md-ellipsis> Per‑class metrics: </span> </a> </li> <li class=md-nav__item> <a href=#interpretation class=md-nav__link> <span class=md-ellipsis> Interpretation </span> </a> <nav class=md-nav aria-label=Interpretation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#class-0-majority class=md-nav__link> <span class=md-ellipsis> Class 0 (majority) </span> </a> </li> <li class=md-nav__item> <a href=#class-1-minority class=md-nav__link> <span class=md-ellipsis> Class 1 (minority) </span> </a> </li> <li class=md-nav__item> <a href=#macro-averages-unweighted class=md-nav__link> <span class=md-ellipsis> Macro averages (unweighted) </span> </a> </li> <li class=md-nav__item> <a href=#weighted-averages-by-class-frequency class=md-nav__link> <span class=md-ellipsis> Weighted averages (by class frequency) </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9-conclusion class=md-nav__link> <span class=md-ellipsis> 9. Conclusion </span> </a> <nav class=md-nav aria-label="9. Conclusion"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#submission-github-pages class=md-nav__link> <span class=md-ellipsis> Submission — GitHub Pages </span> </a> </li> <li class=md-nav__item> <a href=#academic-integrity-ai-collaboration class=md-nav__link> <span class=md-ellipsis> Academic Integrity &amp; AI Collaboration </span> </a> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> <span class=md-ellipsis> References </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=classification-project>Classification Project</h1> <p>The complete source code for this project is available <a href=https://github.com/thomaschiari/deep-learning-classification-project>here</a>.</p> <h2 id=1-dataset-selection>1. Dataset Selection</h2> <p><strong>Name</strong>: Bank Marketing Dataset</p> <p><strong>Source</strong>: UCI Machine Learning Repository <a href=https://archive.ics.uci.edu/dataset/222/bank%2Bmarketing>available here</a></p> <p><strong>Size</strong>: 41188 rows, with 20 features and 1 target variable</p> <p><strong>Task</strong>: Binary classification, predicting whether a client will subscribe to a term deposit</p> <p><strong>Why this dataset?</strong> </p> <p>We wanted a real-world, business-relevant classification problem with enough rows and feature diversity to justify an MLP. The Bank Marketing dataset provides 41k examples with both categorical and numeric attributes (client profile + campaign context), enabling preprocessing (one-hot + scaling) and meaningful model comparisons. The target is notably imbalanced (~89% “no”, ~11% “yes”), making it more complex than a balanced dataset. The dataset also has no missing values, and is a public academic dataset.</p> <h2 id=2-dataset-explanation>2. Dataset Explanation</h2> <p>The dataset represents records from telemarketing campaigns of a Portuguese bank. The goal is to predict whether the client will subscribe to a term deposit. The file <code>bank-additional-full.csv</code> contains 41,188 examples and 20 inputs. There are no missing values.</p> <p>The target is column <code>y</code>. It is a binary variable, indicating whether the client will subscribe to a term deposit, and is imbalanced (~89% “no”, ~11% “yes”).</p> <p><strong>Features</strong>:</p> <ul> <li><code>age</code>: numeric</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/hist_age.png data-desc-position=bottom><img alt="Hist Age" src=../images/hist_age.png></a></p> <ul> <li><code>job</code>: categorical, indicating the type of job of the client</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/bar_job.png data-desc-position=bottom><img alt="Bar Job" src=../images/bar_job.png></a></p> <ul> <li><code>marital</code>: categorical, indicating the marital status of the client</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/bar_marital.png data-desc-position=bottom><img alt="Bar Marital" src=../images/bar_marital.png></a></p> <ul> <li><code>education</code>: categorical, indicating the education level of the client</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/bar_education.png data-desc-position=bottom><img alt="Bar Education" src=../images/bar_education.png></a></p> <ul> <li><code>default</code>: categorical, indicating if the client has credit in default</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/bar_default.png data-desc-position=bottom><img alt="Bar Default" src=../images/bar_default.png></a></p> <ul> <li><code>housing</code>: categorical, indicating if the client has a housing loan</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/bar_housing.png data-desc-position=bottom><img alt="Bar Housing" src=../images/bar_housing.png></a></p> <ul> <li><code>loan</code>: categorical, indicating if the client has a personal loan</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/bar_loan.png data-desc-position=bottom><img alt="Bar Loan" src=../images/bar_loan.png></a></p> <ul> <li><code>contact</code>: categorical, indicating the communication type (e.g. telephone, cellular...)</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/bar_contact.png data-desc-position=bottom><img alt="Bar Contact" src=../images/bar_contact.png></a></p> <ul> <li><code>month</code>: categorical, indicating the last contact month of the year</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/bar_month.png data-desc-position=bottom><img alt="Bar Month" src=../images/bar_month.png></a></p> <ul> <li><code>day_of_week</code>: categorical, indicating the last contact day of the week</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/bar_day_of_week.png data-desc-position=bottom><img alt="Bar Day of Week" src=../images/bar_day_of_week.png></a></p> <ul> <li> <p><code>duration</code>: numeric, indicating the last call duration in seconds (this feature is dropped because it leaks the outcome, e.g. <code>duration=0</code> → always <code>y="no"</code>)</p> </li> <li> <p><code>campaign</code>: numeric, indicating the number of contacts in the current campaign</p> </li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/hist_campaign.png data-desc-position=bottom><img alt="Hist Campaign" src=../images/hist_campaign.png></a></p> <ul> <li><code>pdays</code>: numeric, indicating the number of days that passed by after the client was last contacted (999 means not previously contacted)</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/hist_pdays.png data-desc-position=bottom><img alt="Hist Pdays" src=../images/hist_pdays.png></a></p> <ul> <li><code>previous</code>: numeric, indicating the number of contacts before the current campaign</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/hist_previous.png data-desc-position=bottom><img alt="Hist Previous" src=../images/hist_previous.png></a></p> <ul> <li><code>poutcome</code>: categorical, indicating the outcome of the previous marketing campaign</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/bar_poutcome.png data-desc-position=bottom><img alt="Bar Poutcome" src=../images/bar_poutcome.png></a></p> <ul> <li><code>emp.var.rate</code>: numeric, indicating the employment variation rate</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/hist_emp.var.rate.png data-desc-position=bottom><img alt="Hist Emp Var Rate" src=../images/hist_emp.var.rate.png></a></p> <ul> <li><code>cons.price.idx</code>: numeric, indicating the consumer price index</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/hist_cons.price.idx.png data-desc-position=bottom><img alt="Hist Cons Price Idx" src=../images/hist_cons.price.idx.png></a></p> <ul> <li><code>cons.conf.idx</code>: numeric, indicating the consumer confidence index</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/hist_cons.conf.idx.png data-desc-position=bottom><img alt="Hist Cons Conf Idx" src=../images/hist_cons.conf.idx.png></a></p> <ul> <li><code>euribor3m</code>: numeric, indicating the euribor 3 month rate</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/hist_euribor3m.png data-desc-position=bottom><img alt="Hist Euribor3m" src=../images/hist_euribor3m.png></a></p> <ul> <li><code>nr.employed</code>: numeric, indicating the number of employees</li> </ul> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/hist_nr.employed.png data-desc-position=bottom><img alt="Hist Nr Employed" src=../images/hist_nr.employed.png></a></p> <p>The last 5 features are macroeconomic indicators, important for context.</p> <p><strong>Potential issues to address</strong></p> <ul> <li>Imbalance: the target is imbalanced (~89% “no”, ~11% “yes”).</li> </ul> <p><strong>Summary statistics and visuals</strong></p> <p>Class distribution of the target:</p> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/class_distribution.png data-desc-position=bottom><img alt="Class distribution" src=../images/class_distribution.png></a></p> <p>Correlation matrix of the numeric features:</p> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=images/correlation_matrix.png data-desc-position=bottom><img alt="Correlation matrix" src=images/correlation_matrix.png></a></p> <p>Summary statistics of the numeric features:</p> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/summary_statistics.png data-desc-position=bottom><img alt="Summary statistics" src=../images/summary_statistics.png></a></p> <p>We additionally created a new feature <code>prev_contacted</code>, indicating if the client was previously contacted by treating the <code>pdays</code> feature as 1 if the client was previously contacted, and 0 otherwise.</p> <h2 id=3-data-preprocessing>3. Data Preprocessing</h2> <h3 id=treating-missing-values-and-duplicates>Treating missing values and duplicates</h3> <p>The first step in order to clean and preprocess the data was to treat the variable <code>pdays</code> for when there was no previous contact. For that, we used the created <code>prev_contacted</code> feature to filter the rows where the client was not previously contacted, then imputed the median value of <code>pdays</code>. This is the only feature with "missing" values, and we chose to fill with the median value to avoid introducing new labels.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>df</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=n>df</span><span class=p>[</span><span class=s2>"prev_contacted"</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>,</span> <span class=s2>"pdays"</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=n>imputer</span> <span class=o>=</span> <span class=n>SimpleImputer</span><span class=p>(</span><span class=n>strategy</span><span class=o>=</span><span class=s1>'median'</span><span class=p>)</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=n>df</span><span class=p>[</span><span class=n>numeric_features</span><span class=p>]</span> <span class=o>=</span> <span class=n>imputer</span><span class=o>.</span><span class=n>fit_transform</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>numeric_features</span><span class=p>])</span>
</span></code></pre></div> <p>The next step was to drop the duplicates. for that, we used the <code>drop_duplicates</code> function: </p> <div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=n>before_n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>df</span><span class=p>)</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=n>df</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>drop_duplicates</span><span class=p>()</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=n>after_n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>df</span><span class=p>)</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=n>dedup_removed</span> <span class=o>=</span> <span class=n>before_n</span> <span class=o>-</span> <span class=n>after_n</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=n>dedup_removed</span>
</span></code></pre></div> <p>With that, we removed 1784 rows that were exactly the same. </p> <h3 id=scaling-numerical-features>Scaling numerical features</h3> <p>The next step was to scale numerical features. We applied standardization (z-score), which centers features around 0 with standard deviation of 1. This was made in order to remove the effect of different scales between features, equalizing variances, making the data robust to outliers. Min-max scaling was also considered, but it is highly sensitive to outliers. A few extremes may squash most data into a narrow range. </p> <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>numeric_features</span><span class=p>:</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>    <span class=n>df</span><span class=p>[</span><span class=n>c</span><span class=p>]</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_numeric</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>c</span><span class=p>],</span> <span class=n>errors</span><span class=o>=</span><span class=s1>'coerce'</span><span class=p>)</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=n>scaler</span> <span class=o>=</span> <span class=n>StandardScaler</span><span class=p>()</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=n>df</span><span class=p>[</span><span class=n>numeric_features</span><span class=p>]</span> <span class=o>=</span> <span class=n>scaler</span><span class=o>.</span><span class=n>fit_transform</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>numeric_features</span><span class=p>])</span>
</span></code></pre></div> <p>With that, we keep the distribution of the data, but the values are normalized relative to other features. Here is a histogram of the <code>age</code> feature after scaling:</p> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/age_distribution_after_scaling.png data-desc-position=bottom><img alt="Age after scaling" src=../images/age_distribution_after_scaling.png></a></p> <h3 id=encoding-categorical-features>Encoding categorical features</h3> <p>We used one-hot encoding for all categorical features. We kept all information, avoiding the creation of a reference level. This is because neural networks are not sensitive to multicollinearity in the same way as linear models. We chose one-hot because it encodes each category as a binary feature, avoiding the creation of an order between the categories.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>X_cat</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>get_dummies</span><span class=p>(</span><span class=n>df</span><span class=p>[</span><span class=n>categorical_features</span><span class=p>],</span> <span class=n>drop_first</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=n>processed</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>    <span class=p>[</span><span class=n>df</span><span class=p>[</span><span class=n>numeric_features</span><span class=p>]</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>),</span> <span class=n>X_cat</span><span class=p>],</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>    <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=p>)</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=n>processed</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=s2>"y"</span><span class=p>,</span> <span class=n>df</span><span class=p>[</span><span class=s2>"y"</span><span class=p>]</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>int8</span><span class=p>))</span>
</span></code></pre></div> <p>Finally, we saved the processed data into a CSV file in order to use it as input for the MLP in the next step.</p> <h2 id=4-mlp-implementation>4. MLP Implementation</h2> <p>Now, we are going to implement a multi-layer perceptron (MLP) from scratch using Numpy operations, trained with mini-batch SGD and cross-entropy. The model supports an arbitrary number of hidden layers selectable via CLI (argument parser), and supports <code>relu</code>, <code>tanh</code> and <code>sigmoid</code> activations. </p> <p>We train on the data that was the output of the previous step, where the first column is the target and all remaining columns are the treated features. We use a split of 70% for training, 15% for validation and 15% for testing in the training loop. </p> <p>How to run the MLP (in the source code repository):</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>python<span class=w> </span>src/mlp_numpy.py<span class=w> </span>--data<span class=w> </span>data/clean/bank-additional-full-post-preprocessed.csv<span class=w> </span>--hidden<span class=w> </span><span class=m>64</span>,64<span class=w> </span>--activation<span class=w> </span>relu<span class=w> </span>--epochs<span class=w> </span><span class=m>30</span><span class=w> </span>--lr<span class=w> </span><span class=m>0</span>.05<span class=w> </span>--batch_size<span class=w> </span><span class=m>256</span><span class=w> </span>--seed<span class=w> </span><span class=m>42</span>
</span></code></pre></div> <h3 id=hyperparameters>Hyperparameters</h3> <ul> <li> <p>Hidden Layers: selectable via CLI (size of each layer). Default is <code>64</code>.</p> </li> <li> <p>Activation Functions: selectable via CLI (either <code>relu</code>, <code>tanh</code> or <code>sigmoid</code>). Default is <code>relu</code>.</p> </li> <li> <p>Epochs: selectable via CLI (number of epochs). Default is <code>30</code>.</p> </li> <li> <p>Learning Rate: selectable via CLI (learning rate). Default is <code>0.05</code>.</p> </li> <li> <p>Batch Size: selectable via CLI (batch size). Default is <code>256</code>.</p> </li> <li> <p>Seed: selectable via CLI (random seed). Default is <code>42</code>.</p> </li> </ul> <h3 id=architecture>Architecture</h3> <p>The model is a feed-forward network: input -&gt; hidden layers -&gt; output logits -&gt; softmax. Here is the initial implementation of the MLP class:</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=k>class</span><span class=w> </span><span class=nc>MLP</span><span class=p>:</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>input_dim</span><span class=p>,</span> <span class=n>hidden_layers</span><span class=p>,</span> <span class=n>num_classes</span><span class=p>,</span> <span class=n>activation</span><span class=o>=</span><span class=s2>"relu"</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span> <span class=n>l2</span><span class=o>=</span><span class=mf>0.0</span><span class=p>):</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>        <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>=</span> <span class=n>activation</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>l2</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>l2</span><span class=p>)</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>        <span class=n>rng</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>default_rng</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>        <span class=n>sizes</span> <span class=o>=</span> <span class=p>[</span><span class=n>input_dim</span><span class=p>]</span> <span class=o>+</span> <span class=nb>list</span><span class=p>(</span><span class=n>hidden_layers</span><span class=p>)</span> <span class=o>+</span> <span class=p>[</span><span class=n>num_classes</span><span class=p>]</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>        <span class=bp>self</span><span class=o>.</span><span class=n>W</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>        <span class=bp>self</span><span class=o>.</span><span class=n>b</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>sizes</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>            <span class=n>fan_in</span><span class=p>,</span> <span class=n>fan_out</span> <span class=o>=</span> <span class=n>sizes</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>sizes</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>            <span class=k>if</span> <span class=n>activation</span> <span class=o>==</span> <span class=s2>"relu"</span><span class=p>:</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>                <span class=n>W</span> <span class=o>=</span> <span class=n>rng</span><span class=o>.</span><span class=n>normal</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mf>2.0</span><span class=o>/</span><span class=n>fan_in</span><span class=p>),</span> <span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>fan_in</span><span class=p>,</span> <span class=n>fan_out</span><span class=p>))</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>            <span class=k>else</span><span class=p>:</span>  
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>                <span class=n>W</span> <span class=o>=</span> <span class=n>rng</span><span class=o>.</span><span class=n>normal</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mf>1.0</span><span class=o>/</span><span class=n>fan_in</span><span class=p>),</span> <span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>fan_in</span><span class=p>,</span> <span class=n>fan_out</span><span class=p>))</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>            <span class=n>b</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=n>fan_out</span><span class=p>),</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a>            <span class=bp>self</span><span class=o>.</span><span class=n>W</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>W</span><span class=p>);</span> <span class=bp>self</span><span class=o>.</span><span class=n>b</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></code></pre></div> <h3 id=activation-functions>Activation functions</h3> <p>Activation functions introduce non-linearity to the model, allowing it to learn non-linear boundaries. We support three activation functions: <code>relu</code>, <code>tanh</code> and <code>sigmoid</code>. Here is the implementation of the activation functions:</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># activation functions</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=k>def</span><span class=w> </span><span class=nf>act_forward</span><span class=p>(</span><span class=n>z</span><span class=p>,</span> <span class=n>kind</span><span class=p>):</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>    <span class=k>if</span> <span class=n>kind</span> <span class=o>==</span> <span class=s2>"relu"</span><span class=p>:</span>   
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>        <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>maximum</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>z</span><span class=p>)</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>    <span class=k>if</span> <span class=n>kind</span> <span class=o>==</span> <span class=s2>"tanh"</span><span class=p>:</span>   
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>        <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>tanh</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>    <span class=k>if</span> <span class=n>kind</span> <span class=o>==</span> <span class=s2>"sigmoid"</span><span class=p>:</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>        <span class=k>return</span> <span class=mf>1.0</span> <span class=o>/</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=o>-</span><span class=n>z</span><span class=p>))</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>"activation must be relu/tanh/sigmoid"</span><span class=p>)</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=k>def</span><span class=w> </span><span class=nf>act_backward</span><span class=p>(</span><span class=n>z</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>kind</span><span class=p>):</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>    <span class=k>if</span> <span class=n>kind</span> <span class=o>==</span> <span class=s2>"relu"</span><span class=p>:</span>    
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>        <span class=k>return</span> <span class=p>(</span><span class=n>z</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>z</span><span class=o>.</span><span class=n>dtype</span><span class=p>)</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>    <span class=k>if</span> <span class=n>kind</span> <span class=o>==</span> <span class=s2>"tanh"</span><span class=p>:</span>    
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>        <span class=k>return</span> <span class=mf>1.0</span> <span class=o>-</span> <span class=n>a</span><span class=o>*</span><span class=n>a</span>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a>    <span class=k>if</span> <span class=n>kind</span> <span class=o>==</span> <span class=s2>"sigmoid"</span><span class=p>:</span> 
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>        <span class=k>return</span> <span class=n>a</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>a</span><span class=p>)</span>
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>"activation must be relu/tanh/sigmoid"</span><span class=p>)</span>
</span></code></pre></div> <p>The forward pass per layer is implemented as follows:</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=k>def</span><span class=w> </span><span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>X</span><span class=p>):</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=w>    </span><span class=sd>"""Returns probs and caches for backprop"""</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>    <span class=n>A</span> <span class=o>=</span> <span class=n>X</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>    <span class=n>caches</span> <span class=o>=</span> <span class=p>[]</span>  
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>    <span class=n>L</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>W</span><span class=p>)</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>    <span class=k>for</span> <span class=n>l</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>L</span><span class=p>):</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>        <span class=n>Z</span> <span class=o>=</span> <span class=n>A</span> <span class=o>@</span> <span class=bp>self</span><span class=o>.</span><span class=n>W</span><span class=p>[</span><span class=n>l</span><span class=p>]</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>b</span><span class=p>[</span><span class=n>l</span><span class=p>]</span>   
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>        <span class=k>if</span> <span class=n>l</span> <span class=o>&lt;</span> <span class=n>L</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>            <span class=n>A_next</span> <span class=o>=</span> <span class=n>act_forward</span><span class=p>(</span><span class=n>Z</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span><span class=p>)</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>            <span class=n>A_next</span> <span class=o>=</span> <span class=n>Z</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a>        <span class=n>caches</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>A</span><span class=p>,</span> <span class=n>Z</span><span class=p>,</span> <span class=n>A_next</span><span class=p>))</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a>        <span class=n>A</span> <span class=o>=</span> <span class=n>A_next</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>    <span class=n>probs</span> <span class=o>=</span> <span class=n>softmax</span><span class=p>(</span><span class=n>A</span><span class=p>)</span>  
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a>    <span class=k>return</span> <span class=n>probs</span><span class=p>,</span> <span class=n>caches</span>
</span></code></pre></div> <p>And the softmax function, for the output layer, is implemented as follows:</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=k>def</span><span class=w> </span><span class=nf>softmax</span><span class=p>(</span><span class=n>z</span><span class=p>):</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>    <span class=n>z</span> <span class=o>=</span> <span class=n>z</span> <span class=o>-</span> <span class=n>z</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>keepdims</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> 
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>    <span class=n>ez</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>    <span class=k>return</span> <span class=n>ez</span> <span class=o>/</span> <span class=p>(</span><span class=n>ez</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>keepdims</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=o>+</span> <span class=mf>1e-12</span><span class=p>)</span>
</span></code></pre></div> <h3 id=loss-function>Loss function</h3> <p>The loss function is the cross-entropy on the softmax probabilities, calculated as follows:</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=n>tr_loss</span> <span class=o>=</span> <span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>tr_probs</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>Xtr</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=n>ytr</span><span class=p>]</span> <span class=o>+</span> <span class=mf>1e-12</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=n>va_loss</span> <span class=o>=</span> <span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>va_probs</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>Xva</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=n>yva</span><span class=p>]</span> <span class=o>+</span> <span class=mf>1e-12</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></code></pre></div> <h3 id=optimizer>Optimizer</h3> <p>The optimizer is a mini-batch SGD: we shuffle the data, take batches, compute the gradients, backpropagate and update the weights. Here is the implementation of the complete training loop:</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1># train loop</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=k>def</span><span class=w> </span><span class=nf>train</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>Xtr</span><span class=p>,</span> <span class=n>ytr</span><span class=p>,</span> <span class=n>Xva</span><span class=p>,</span> <span class=n>yva</span><span class=p>,</span> <span class=n>epochs</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span> <span class=n>lr</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=mi>256</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>):</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>    <span class=n>rng</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>default_rng</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>    <span class=n>n</span> <span class=o>=</span> <span class=n>Xtr</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>    <span class=k>for</span> <span class=n>epoch</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>epochs</span><span class=o>+</span><span class=mi>1</span><span class=p>):</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>        <span class=c1># mini-batch SGD</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a>        <span class=n>idx</span> <span class=o>=</span> <span class=n>rng</span><span class=o>.</span><span class=n>permutation</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a>        <span class=k>for</span> <span class=n>start</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>):</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>            <span class=n>b</span> <span class=o>=</span> <span class=n>idx</span><span class=p>[</span><span class=n>start</span><span class=p>:</span><span class=n>start</span><span class=o>+</span><span class=n>batch_size</span><span class=p>]</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>            <span class=n>probs</span><span class=p>,</span> <span class=n>caches</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>forward</span><span class=p>(</span><span class=n>Xtr</span><span class=p>[</span><span class=n>b</span><span class=p>])</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>            <span class=n>dW</span><span class=p>,</span> <span class=n>db</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>backward</span><span class=p>(</span><span class=n>probs</span><span class=p>,</span> <span class=n>ytr</span><span class=p>[</span><span class=n>b</span><span class=p>],</span> <span class=n>caches</span><span class=p>)</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>            <span class=n>model</span><span class=o>.</span><span class=n>step</span><span class=p>(</span><span class=n>dW</span><span class=p>,</span> <span class=n>db</span><span class=p>,</span> <span class=n>lr</span><span class=p>)</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>        <span class=c1># metrics</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a>        <span class=n>tr_pred</span><span class=p>,</span> <span class=n>tr_probs</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>Xtr</span><span class=p>)</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>        <span class=n>va_pred</span><span class=p>,</span> <span class=n>va_probs</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>Xva</span><span class=p>)</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>        <span class=n>tr_acc</span> <span class=o>=</span> <span class=n>accuracy</span><span class=p>(</span><span class=n>ytr</span><span class=p>,</span> <span class=n>tr_pred</span><span class=p>)</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>        <span class=n>va_acc</span> <span class=o>=</span> <span class=n>accuracy</span><span class=p>(</span><span class=n>yva</span><span class=p>,</span> <span class=n>va_pred</span><span class=p>)</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>        <span class=n>tr_loss</span> <span class=o>=</span> <span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>tr_probs</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>Xtr</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=n>ytr</span><span class=p>]</span> <span class=o>+</span> <span class=mf>1e-12</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a>        <span class=n>va_loss</span> <span class=o>=</span> <span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>va_probs</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>Xva</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=n>yva</span><span class=p>]</span> <span class=o>+</span> <span class=mf>1e-12</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>"epoch </span><span class=si>{</span><span class=n>epoch</span><span class=si>:</span><span class=s2>03d</span><span class=si>}</span><span class=s2> | train loss </span><span class=si>{</span><span class=n>tr_loss</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2> acc </span><span class=si>{</span><span class=n>tr_acc</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2> | val loss </span><span class=si>{</span><span class=n>va_loss</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2> acc </span><span class=si>{</span><span class=n>va_acc</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</span></code></pre></div> <h3 id=final-model-implementation>Final model implementation</h3> <p>The final model includes a CLI to parse the arguments, load the processed CSV, make the stratification, build the model, train, and evaluate on test:</p> <div class="language-py highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=kn>import</span><span class=w> </span><span class=nn>argparse</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=kn>from</span><span class=w> </span><span class=nn>pathlib</span><span class=w> </span><span class=kn>import</span> <span class=n>Path</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=kn>import</span><span class=w> </span><span class=nn>pandas</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>pd</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=c1># activation functions</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=k>def</span><span class=w> </span><span class=nf>act_forward</span><span class=p>(</span><span class=n>z</span><span class=p>,</span> <span class=n>kind</span><span class=p>):</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>    <span class=k>if</span> <span class=n>kind</span> <span class=o>==</span> <span class=s2>"relu"</span><span class=p>:</span>   
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>        <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>maximum</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>z</span><span class=p>)</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>    <span class=k>if</span> <span class=n>kind</span> <span class=o>==</span> <span class=s2>"tanh"</span><span class=p>:</span>   
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>        <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>tanh</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>    <span class=k>if</span> <span class=n>kind</span> <span class=o>==</span> <span class=s2>"sigmoid"</span><span class=p>:</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>        <span class=k>return</span> <span class=mf>1.0</span> <span class=o>/</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=o>-</span><span class=n>z</span><span class=p>))</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>"activation must be relu/tanh/sigmoid"</span><span class=p>)</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=k>def</span><span class=w> </span><span class=nf>act_backward</span><span class=p>(</span><span class=n>z</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>kind</span><span class=p>):</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a>    <span class=k>if</span> <span class=n>kind</span> <span class=o>==</span> <span class=s2>"relu"</span><span class=p>:</span>    
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a>        <span class=k>return</span> <span class=p>(</span><span class=n>z</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>z</span><span class=o>.</span><span class=n>dtype</span><span class=p>)</span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a>    <span class=k>if</span> <span class=n>kind</span> <span class=o>==</span> <span class=s2>"tanh"</span><span class=p>:</span>    
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a>        <span class=k>return</span> <span class=mf>1.0</span> <span class=o>-</span> <span class=n>a</span><span class=o>*</span><span class=n>a</span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a>    <span class=k>if</span> <span class=n>kind</span> <span class=o>==</span> <span class=s2>"sigmoid"</span><span class=p>:</span> 
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a>        <span class=k>return</span> <span class=n>a</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>a</span><span class=p>)</span>
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a>    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>"activation must be relu/tanh/sigmoid"</span><span class=p>)</span>
</span><span id=__span-11-24><a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a>
</span><span id=__span-11-25><a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a><span class=c1># helpers</span>
</span><span id=__span-11-26><a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a><span class=k>def</span><span class=w> </span><span class=nf>parse_hidden</span><span class=p>(</span><span class=n>s</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-11-27><a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a>    <span class=k>return</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>s</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>","</span><span class=p>)]</span> <span class=k>if</span> <span class=n>s</span> <span class=k>else</span> <span class=p>[</span><span class=mi>64</span><span class=p>]</span>
</span><span id=__span-11-28><a id=__codelineno-11-28 name=__codelineno-11-28 href=#__codelineno-11-28></a>
</span><span id=__span-11-29><a id=__codelineno-11-29 name=__codelineno-11-29 href=#__codelineno-11-29></a><span class=k>def</span><span class=w> </span><span class=nf>softmax</span><span class=p>(</span><span class=n>z</span><span class=p>):</span>
</span><span id=__span-11-30><a id=__codelineno-11-30 name=__codelineno-11-30 href=#__codelineno-11-30></a>    <span class=n>z</span> <span class=o>=</span> <span class=n>z</span> <span class=o>-</span> <span class=n>z</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>keepdims</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> 
</span><span id=__span-11-31><a id=__codelineno-11-31 name=__codelineno-11-31 href=#__codelineno-11-31></a>    <span class=n>ez</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=n>z</span><span class=p>)</span>
</span><span id=__span-11-32><a id=__codelineno-11-32 name=__codelineno-11-32 href=#__codelineno-11-32></a>    <span class=k>return</span> <span class=n>ez</span> <span class=o>/</span> <span class=p>(</span><span class=n>ez</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>keepdims</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=o>+</span> <span class=mf>1e-12</span><span class=p>)</span>
</span><span id=__span-11-33><a id=__codelineno-11-33 name=__codelineno-11-33 href=#__codelineno-11-33></a>
</span><span id=__span-11-34><a id=__codelineno-11-34 name=__codelineno-11-34 href=#__codelineno-11-34></a><span class=k>def</span><span class=w> </span><span class=nf>accuracy</span><span class=p>(</span><span class=n>y_true</span><span class=p>,</span> <span class=n>y_pred</span><span class=p>):</span>
</span><span id=__span-11-35><a id=__codelineno-11-35 name=__codelineno-11-35 href=#__codelineno-11-35></a>    <span class=k>return</span> <span class=nb>float</span><span class=p>((</span><span class=n>y_true</span> <span class=o>==</span> <span class=n>y_pred</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>())</span>
</span><span id=__span-11-36><a id=__codelineno-11-36 name=__codelineno-11-36 href=#__codelineno-11-36></a>
</span><span id=__span-11-37><a id=__codelineno-11-37 name=__codelineno-11-37 href=#__codelineno-11-37></a><span class=k>def</span><span class=w> </span><span class=nf>stratified_split</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>train</span><span class=o>=</span><span class=mf>0.70</span><span class=p>,</span> <span class=n>val</span><span class=o>=</span><span class=mf>0.15</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>):</span>
</span><span id=__span-11-38><a id=__codelineno-11-38 name=__codelineno-11-38 href=#__codelineno-11-38></a>    <span class=n>rng</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>default_rng</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span><span id=__span-11-39><a id=__codelineno-11-39 name=__codelineno-11-39 href=#__codelineno-11-39></a>    <span class=n>classes</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>unique</span><span class=p>(</span><span class=n>y</span><span class=p>)</span>
</span><span id=__span-11-40><a id=__codelineno-11-40 name=__codelineno-11-40 href=#__codelineno-11-40></a>    <span class=n>idx_tr</span><span class=p>,</span> <span class=n>idx_va</span><span class=p>,</span> <span class=n>idx_te</span> <span class=o>=</span> <span class=p>[],</span> <span class=p>[],</span> <span class=p>[]</span>
</span><span id=__span-11-41><a id=__codelineno-11-41 name=__codelineno-11-41 href=#__codelineno-11-41></a>    <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>classes</span><span class=p>:</span>
</span><span id=__span-11-42><a id=__codelineno-11-42 name=__codelineno-11-42 href=#__codelineno-11-42></a>        <span class=n>idx</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>where</span><span class=p>(</span><span class=n>y</span> <span class=o>==</span> <span class=n>c</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-11-43><a id=__codelineno-11-43 name=__codelineno-11-43 href=#__codelineno-11-43></a>        <span class=n>rng</span><span class=o>.</span><span class=n>shuffle</span><span class=p>(</span><span class=n>idx</span><span class=p>)</span>
</span><span id=__span-11-44><a id=__codelineno-11-44 name=__codelineno-11-44 href=#__codelineno-11-44></a>        <span class=n>n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>idx</span><span class=p>)</span>
</span><span id=__span-11-45><a id=__codelineno-11-45 name=__codelineno-11-45 href=#__codelineno-11-45></a>        <span class=n>n_tr</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>n</span> <span class=o>*</span> <span class=n>train</span><span class=p>)</span>
</span><span id=__span-11-46><a id=__codelineno-11-46 name=__codelineno-11-46 href=#__codelineno-11-46></a>        <span class=n>n_va</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>n</span> <span class=o>*</span> <span class=n>val</span><span class=p>)</span>
</span><span id=__span-11-47><a id=__codelineno-11-47 name=__codelineno-11-47 href=#__codelineno-11-47></a>        <span class=n>idx_tr</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>idx</span><span class=p>[:</span><span class=n>n_tr</span><span class=p>])</span>
</span><span id=__span-11-48><a id=__codelineno-11-48 name=__codelineno-11-48 href=#__codelineno-11-48></a>        <span class=n>idx_va</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>idx</span><span class=p>[</span><span class=n>n_tr</span><span class=p>:</span><span class=n>n_tr</span><span class=o>+</span><span class=n>n_va</span><span class=p>])</span>
</span><span id=__span-11-49><a id=__codelineno-11-49 name=__codelineno-11-49 href=#__codelineno-11-49></a>        <span class=n>idx_te</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>idx</span><span class=p>[</span><span class=n>n_tr</span><span class=o>+</span><span class=n>n_va</span><span class=p>:])</span>
</span><span id=__span-11-50><a id=__codelineno-11-50 name=__codelineno-11-50 href=#__codelineno-11-50></a>    <span class=n>idx_tr</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>concatenate</span><span class=p>(</span><span class=n>idx_tr</span><span class=p>);</span> <span class=n>idx_va</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>concatenate</span><span class=p>(</span><span class=n>idx_va</span><span class=p>);</span> <span class=n>idx_te</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>concatenate</span><span class=p>(</span><span class=n>idx_te</span><span class=p>)</span>
</span><span id=__span-11-51><a id=__codelineno-11-51 name=__codelineno-11-51 href=#__codelineno-11-51></a>    <span class=n>rng</span><span class=o>.</span><span class=n>shuffle</span><span class=p>(</span><span class=n>idx_tr</span><span class=p>);</span> <span class=n>rng</span><span class=o>.</span><span class=n>shuffle</span><span class=p>(</span><span class=n>idx_va</span><span class=p>);</span> <span class=n>rng</span><span class=o>.</span><span class=n>shuffle</span><span class=p>(</span><span class=n>idx_te</span><span class=p>)</span>
</span><span id=__span-11-52><a id=__codelineno-11-52 name=__codelineno-11-52 href=#__codelineno-11-52></a>    <span class=k>return</span> <span class=p>(</span><span class=n>X</span><span class=p>[</span><span class=n>idx_tr</span><span class=p>],</span> <span class=n>y</span><span class=p>[</span><span class=n>idx_tr</span><span class=p>]),</span> <span class=p>(</span><span class=n>X</span><span class=p>[</span><span class=n>idx_va</span><span class=p>],</span> <span class=n>y</span><span class=p>[</span><span class=n>idx_va</span><span class=p>]),</span> <span class=p>(</span><span class=n>X</span><span class=p>[</span><span class=n>idx_te</span><span class=p>],</span> <span class=n>y</span><span class=p>[</span><span class=n>idx_te</span><span class=p>])</span>
</span><span id=__span-11-53><a id=__codelineno-11-53 name=__codelineno-11-53 href=#__codelineno-11-53></a>
</span><span id=__span-11-54><a id=__codelineno-11-54 name=__codelineno-11-54 href=#__codelineno-11-54></a>
</span><span id=__span-11-55><a id=__codelineno-11-55 name=__codelineno-11-55 href=#__codelineno-11-55></a><span class=c1># mlp class</span>
</span><span id=__span-11-56><a id=__codelineno-11-56 name=__codelineno-11-56 href=#__codelineno-11-56></a><span class=k>class</span><span class=w> </span><span class=nc>MLP</span><span class=p>:</span>
</span><span id=__span-11-57><a id=__codelineno-11-57 name=__codelineno-11-57 href=#__codelineno-11-57></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>input_dim</span><span class=p>,</span> <span class=n>hidden_layers</span><span class=p>,</span> <span class=n>num_classes</span><span class=p>,</span> <span class=n>activation</span><span class=o>=</span><span class=s2>"relu"</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span> <span class=n>l2</span><span class=o>=</span><span class=mf>0.0</span><span class=p>):</span>
</span><span id=__span-11-58><a id=__codelineno-11-58 name=__codelineno-11-58 href=#__codelineno-11-58></a>        <span class=bp>self</span><span class=o>.</span><span class=n>activation</span> <span class=o>=</span> <span class=n>activation</span>
</span><span id=__span-11-59><a id=__codelineno-11-59 name=__codelineno-11-59 href=#__codelineno-11-59></a>        <span class=bp>self</span><span class=o>.</span><span class=n>l2</span> <span class=o>=</span> <span class=nb>float</span><span class=p>(</span><span class=n>l2</span><span class=p>)</span>
</span><span id=__span-11-60><a id=__codelineno-11-60 name=__codelineno-11-60 href=#__codelineno-11-60></a>        <span class=n>rng</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>default_rng</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span><span id=__span-11-61><a id=__codelineno-11-61 name=__codelineno-11-61 href=#__codelineno-11-61></a>
</span><span id=__span-11-62><a id=__codelineno-11-62 name=__codelineno-11-62 href=#__codelineno-11-62></a>        <span class=n>sizes</span> <span class=o>=</span> <span class=p>[</span><span class=n>input_dim</span><span class=p>]</span> <span class=o>+</span> <span class=nb>list</span><span class=p>(</span><span class=n>hidden_layers</span><span class=p>)</span> <span class=o>+</span> <span class=p>[</span><span class=n>num_classes</span><span class=p>]</span>
</span><span id=__span-11-63><a id=__codelineno-11-63 name=__codelineno-11-63 href=#__codelineno-11-63></a>        <span class=bp>self</span><span class=o>.</span><span class=n>W</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-11-64><a id=__codelineno-11-64 name=__codelineno-11-64 href=#__codelineno-11-64></a>        <span class=bp>self</span><span class=o>.</span><span class=n>b</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-11-65><a id=__codelineno-11-65 name=__codelineno-11-65 href=#__codelineno-11-65></a>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>sizes</span><span class=p>)</span><span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span><span id=__span-11-66><a id=__codelineno-11-66 name=__codelineno-11-66 href=#__codelineno-11-66></a>            <span class=n>fan_in</span><span class=p>,</span> <span class=n>fan_out</span> <span class=o>=</span> <span class=n>sizes</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>sizes</span><span class=p>[</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-11-67><a id=__codelineno-11-67 name=__codelineno-11-67 href=#__codelineno-11-67></a>            <span class=k>if</span> <span class=n>activation</span> <span class=o>==</span> <span class=s2>"relu"</span><span class=p>:</span>
</span><span id=__span-11-68><a id=__codelineno-11-68 name=__codelineno-11-68 href=#__codelineno-11-68></a>                <span class=n>W</span> <span class=o>=</span> <span class=n>rng</span><span class=o>.</span><span class=n>normal</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mf>2.0</span><span class=o>/</span><span class=n>fan_in</span><span class=p>),</span> <span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>fan_in</span><span class=p>,</span> <span class=n>fan_out</span><span class=p>))</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span>
</span><span id=__span-11-69><a id=__codelineno-11-69 name=__codelineno-11-69 href=#__codelineno-11-69></a>            <span class=k>else</span><span class=p>:</span>  
</span><span id=__span-11-70><a id=__codelineno-11-70 name=__codelineno-11-70 href=#__codelineno-11-70></a>                <span class=n>W</span> <span class=o>=</span> <span class=n>rng</span><span class=o>.</span><span class=n>normal</span><span class=p>(</span><span class=mf>0.0</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mf>1.0</span><span class=o>/</span><span class=n>fan_in</span><span class=p>),</span> <span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>fan_in</span><span class=p>,</span> <span class=n>fan_out</span><span class=p>))</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span>
</span><span id=__span-11-71><a id=__codelineno-11-71 name=__codelineno-11-71 href=#__codelineno-11-71></a>            <span class=n>b</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=mi>1</span><span class=p>,</span> <span class=n>fan_out</span><span class=p>),</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span>
</span><span id=__span-11-72><a id=__codelineno-11-72 name=__codelineno-11-72 href=#__codelineno-11-72></a>            <span class=bp>self</span><span class=o>.</span><span class=n>W</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>W</span><span class=p>);</span> <span class=bp>self</span><span class=o>.</span><span class=n>b</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span><span id=__span-11-73><a id=__codelineno-11-73 name=__codelineno-11-73 href=#__codelineno-11-73></a>
</span><span id=__span-11-74><a id=__codelineno-11-74 name=__codelineno-11-74 href=#__codelineno-11-74></a>    <span class=k>def</span><span class=w> </span><span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>X</span><span class=p>):</span>
</span><span id=__span-11-75><a id=__codelineno-11-75 name=__codelineno-11-75 href=#__codelineno-11-75></a><span class=w>        </span><span class=sd>"""Returns probs and caches for backprop"""</span>
</span><span id=__span-11-76><a id=__codelineno-11-76 name=__codelineno-11-76 href=#__codelineno-11-76></a>        <span class=n>A</span> <span class=o>=</span> <span class=n>X</span>
</span><span id=__span-11-77><a id=__codelineno-11-77 name=__codelineno-11-77 href=#__codelineno-11-77></a>        <span class=n>caches</span> <span class=o>=</span> <span class=p>[]</span>  
</span><span id=__span-11-78><a id=__codelineno-11-78 name=__codelineno-11-78 href=#__codelineno-11-78></a>        <span class=n>L</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>W</span><span class=p>)</span>
</span><span id=__span-11-79><a id=__codelineno-11-79 name=__codelineno-11-79 href=#__codelineno-11-79></a>        <span class=k>for</span> <span class=n>l</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>L</span><span class=p>):</span>
</span><span id=__span-11-80><a id=__codelineno-11-80 name=__codelineno-11-80 href=#__codelineno-11-80></a>            <span class=n>Z</span> <span class=o>=</span> <span class=n>A</span> <span class=o>@</span> <span class=bp>self</span><span class=o>.</span><span class=n>W</span><span class=p>[</span><span class=n>l</span><span class=p>]</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>b</span><span class=p>[</span><span class=n>l</span><span class=p>]</span>   
</span><span id=__span-11-81><a id=__codelineno-11-81 name=__codelineno-11-81 href=#__codelineno-11-81></a>            <span class=k>if</span> <span class=n>l</span> <span class=o>&lt;</span> <span class=n>L</span><span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span><span id=__span-11-82><a id=__codelineno-11-82 name=__codelineno-11-82 href=#__codelineno-11-82></a>                <span class=n>A_next</span> <span class=o>=</span> <span class=n>act_forward</span><span class=p>(</span><span class=n>Z</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span><span class=p>)</span>
</span><span id=__span-11-83><a id=__codelineno-11-83 name=__codelineno-11-83 href=#__codelineno-11-83></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-11-84><a id=__codelineno-11-84 name=__codelineno-11-84 href=#__codelineno-11-84></a>                <span class=n>A_next</span> <span class=o>=</span> <span class=n>Z</span>
</span><span id=__span-11-85><a id=__codelineno-11-85 name=__codelineno-11-85 href=#__codelineno-11-85></a>            <span class=n>caches</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>A</span><span class=p>,</span> <span class=n>Z</span><span class=p>,</span> <span class=n>A_next</span><span class=p>))</span>
</span><span id=__span-11-86><a id=__codelineno-11-86 name=__codelineno-11-86 href=#__codelineno-11-86></a>            <span class=n>A</span> <span class=o>=</span> <span class=n>A_next</span>
</span><span id=__span-11-87><a id=__codelineno-11-87 name=__codelineno-11-87 href=#__codelineno-11-87></a>        <span class=n>probs</span> <span class=o>=</span> <span class=n>softmax</span><span class=p>(</span><span class=n>A</span><span class=p>)</span>  
</span><span id=__span-11-88><a id=__codelineno-11-88 name=__codelineno-11-88 href=#__codelineno-11-88></a>        <span class=k>return</span> <span class=n>probs</span><span class=p>,</span> <span class=n>caches</span>
</span><span id=__span-11-89><a id=__codelineno-11-89 name=__codelineno-11-89 href=#__codelineno-11-89></a>
</span><span id=__span-11-90><a id=__codelineno-11-90 name=__codelineno-11-90 href=#__codelineno-11-90></a>    <span class=k>def</span><span class=w> </span><span class=nf>backward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>probs</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>caches</span><span class=p>):</span>
</span><span id=__span-11-91><a id=__codelineno-11-91 name=__codelineno-11-91 href=#__codelineno-11-91></a><span class=w>        </span><span class=sd>"""Cross-entropy grads; returns dW, db lists"""</span>
</span><span id=__span-11-92><a id=__codelineno-11-92 name=__codelineno-11-92 href=#__codelineno-11-92></a>        <span class=n>N</span> <span class=o>=</span> <span class=n>y</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-11-93><a id=__codelineno-11-93 name=__codelineno-11-93 href=#__codelineno-11-93></a>        <span class=n>L</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>W</span><span class=p>)</span>
</span><span id=__span-11-94><a id=__codelineno-11-94 name=__codelineno-11-94 href=#__codelineno-11-94></a>        <span class=n>dZ</span> <span class=o>=</span> <span class=n>probs</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span><span id=__span-11-95><a id=__codelineno-11-95 name=__codelineno-11-95 href=#__codelineno-11-95></a>        <span class=n>dZ</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>N</span><span class=p>),</span> <span class=n>y</span><span class=p>]</span> <span class=o>-=</span> <span class=mf>1.0</span>
</span><span id=__span-11-96><a id=__codelineno-11-96 name=__codelineno-11-96 href=#__codelineno-11-96></a>        <span class=n>dZ</span> <span class=o>/=</span> <span class=n>N</span>
</span><span id=__span-11-97><a id=__codelineno-11-97 name=__codelineno-11-97 href=#__codelineno-11-97></a>
</span><span id=__span-11-98><a id=__codelineno-11-98 name=__codelineno-11-98 href=#__codelineno-11-98></a>        <span class=n>dW_list</span><span class=p>,</span> <span class=n>db_list</span> <span class=o>=</span> <span class=p>[</span><span class=kc>None</span><span class=p>]</span><span class=o>*</span><span class=n>L</span><span class=p>,</span> <span class=p>[</span><span class=kc>None</span><span class=p>]</span><span class=o>*</span><span class=n>L</span>
</span><span id=__span-11-99><a id=__codelineno-11-99 name=__codelineno-11-99 href=#__codelineno-11-99></a>        <span class=k>for</span> <span class=n>l</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=n>L</span><span class=p>)):</span>
</span><span id=__span-11-100><a id=__codelineno-11-100 name=__codelineno-11-100 href=#__codelineno-11-100></a>            <span class=n>A_prev</span><span class=p>,</span> <span class=n>Z</span><span class=p>,</span> <span class=n>A</span> <span class=o>=</span> <span class=n>caches</span><span class=p>[</span><span class=n>l</span><span class=p>]</span>
</span><span id=__span-11-101><a id=__codelineno-11-101 name=__codelineno-11-101 href=#__codelineno-11-101></a>            <span class=n>dW</span> <span class=o>=</span> <span class=n>A_prev</span><span class=o>.</span><span class=n>T</span> <span class=o>@</span> <span class=n>dZ</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>l2</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>W</span><span class=p>[</span><span class=n>l</span><span class=p>]</span>
</span><span id=__span-11-102><a id=__codelineno-11-102 name=__codelineno-11-102 href=#__codelineno-11-102></a>            <span class=n>db</span> <span class=o>=</span> <span class=n>dZ</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>keepdims</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-11-103><a id=__codelineno-11-103 name=__codelineno-11-103 href=#__codelineno-11-103></a>            <span class=n>dW_list</span><span class=p>[</span><span class=n>l</span><span class=p>]</span> <span class=o>=</span> <span class=n>dW</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span>
</span><span id=__span-11-104><a id=__codelineno-11-104 name=__codelineno-11-104 href=#__codelineno-11-104></a>            <span class=n>db_list</span><span class=p>[</span><span class=n>l</span><span class=p>]</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span>
</span><span id=__span-11-105><a id=__codelineno-11-105 name=__codelineno-11-105 href=#__codelineno-11-105></a>
</span><span id=__span-11-106><a id=__codelineno-11-106 name=__codelineno-11-106 href=#__codelineno-11-106></a>            <span class=k>if</span> <span class=n>l</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-11-107><a id=__codelineno-11-107 name=__codelineno-11-107 href=#__codelineno-11-107></a>                <span class=n>dA_prev</span> <span class=o>=</span> <span class=n>dZ</span> <span class=o>@</span> <span class=bp>self</span><span class=o>.</span><span class=n>W</span><span class=p>[</span><span class=n>l</span><span class=p>]</span><span class=o>.</span><span class=n>T</span>
</span><span id=__span-11-108><a id=__codelineno-11-108 name=__codelineno-11-108 href=#__codelineno-11-108></a>                <span class=n>A_prev_prev</span><span class=p>,</span> <span class=n>Z_prev</span><span class=p>,</span> <span class=n>A_prev_post</span> <span class=o>=</span> <span class=n>caches</span><span class=p>[</span><span class=n>l</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-11-109><a id=__codelineno-11-109 name=__codelineno-11-109 href=#__codelineno-11-109></a>                <span class=n>dZ</span> <span class=o>=</span> <span class=n>dA_prev</span> <span class=o>*</span> <span class=n>act_backward</span><span class=p>(</span><span class=n>Z_prev</span><span class=p>,</span> <span class=n>A_prev_post</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>activation</span><span class=p>)</span>
</span><span id=__span-11-110><a id=__codelineno-11-110 name=__codelineno-11-110 href=#__codelineno-11-110></a>        <span class=k>return</span> <span class=n>dW_list</span><span class=p>,</span> <span class=n>db_list</span>
</span><span id=__span-11-111><a id=__codelineno-11-111 name=__codelineno-11-111 href=#__codelineno-11-111></a>
</span><span id=__span-11-112><a id=__codelineno-11-112 name=__codelineno-11-112 href=#__codelineno-11-112></a>    <span class=k>def</span><span class=w> </span><span class=nf>step</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>dW_list</span><span class=p>,</span> <span class=n>db_list</span><span class=p>,</span> <span class=n>lr</span><span class=p>):</span>
</span><span id=__span-11-113><a id=__codelineno-11-113 name=__codelineno-11-113 href=#__codelineno-11-113></a>        <span class=k>for</span> <span class=n>l</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>W</span><span class=p>)):</span>
</span><span id=__span-11-114><a id=__codelineno-11-114 name=__codelineno-11-114 href=#__codelineno-11-114></a>            <span class=bp>self</span><span class=o>.</span><span class=n>W</span><span class=p>[</span><span class=n>l</span><span class=p>]</span> <span class=o>-=</span> <span class=n>lr</span> <span class=o>*</span> <span class=n>dW_list</span><span class=p>[</span><span class=n>l</span><span class=p>]</span>
</span><span id=__span-11-115><a id=__codelineno-11-115 name=__codelineno-11-115 href=#__codelineno-11-115></a>            <span class=bp>self</span><span class=o>.</span><span class=n>b</span><span class=p>[</span><span class=n>l</span><span class=p>]</span> <span class=o>-=</span> <span class=n>lr</span> <span class=o>*</span> <span class=n>db_list</span><span class=p>[</span><span class=n>l</span><span class=p>]</span>
</span><span id=__span-11-116><a id=__codelineno-11-116 name=__codelineno-11-116 href=#__codelineno-11-116></a>
</span><span id=__span-11-117><a id=__codelineno-11-117 name=__codelineno-11-117 href=#__codelineno-11-117></a>    <span class=k>def</span><span class=w> </span><span class=nf>predict</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>X</span><span class=p>):</span>
</span><span id=__span-11-118><a id=__codelineno-11-118 name=__codelineno-11-118 href=#__codelineno-11-118></a>        <span class=n>probs</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>forward</span><span class=p>(</span><span class=n>X</span><span class=p>)</span>
</span><span id=__span-11-119><a id=__codelineno-11-119 name=__codelineno-11-119 href=#__codelineno-11-119></a>        <span class=k>return</span> <span class=n>probs</span><span class=o>.</span><span class=n>argmax</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span> <span class=n>probs</span>
</span><span id=__span-11-120><a id=__codelineno-11-120 name=__codelineno-11-120 href=#__codelineno-11-120></a>
</span><span id=__span-11-121><a id=__codelineno-11-121 name=__codelineno-11-121 href=#__codelineno-11-121></a><span class=c1># train loop</span>
</span><span id=__span-11-122><a id=__codelineno-11-122 name=__codelineno-11-122 href=#__codelineno-11-122></a><span class=k>def</span><span class=w> </span><span class=nf>train</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>Xtr</span><span class=p>,</span> <span class=n>ytr</span><span class=p>,</span> <span class=n>Xva</span><span class=p>,</span> <span class=n>yva</span><span class=p>,</span> <span class=n>epochs</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span> <span class=n>lr</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=mi>256</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>):</span>
</span><span id=__span-11-123><a id=__codelineno-11-123 name=__codelineno-11-123 href=#__codelineno-11-123></a>    <span class=n>rng</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>default_rng</span><span class=p>(</span><span class=n>seed</span><span class=p>)</span>
</span><span id=__span-11-124><a id=__codelineno-11-124 name=__codelineno-11-124 href=#__codelineno-11-124></a>    <span class=n>n</span> <span class=o>=</span> <span class=n>Xtr</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-11-125><a id=__codelineno-11-125 name=__codelineno-11-125 href=#__codelineno-11-125></a>    <span class=k>for</span> <span class=n>epoch</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>epochs</span><span class=o>+</span><span class=mi>1</span><span class=p>):</span>
</span><span id=__span-11-126><a id=__codelineno-11-126 name=__codelineno-11-126 href=#__codelineno-11-126></a>        <span class=c1># mini-batch SGD</span>
</span><span id=__span-11-127><a id=__codelineno-11-127 name=__codelineno-11-127 href=#__codelineno-11-127></a>        <span class=n>idx</span> <span class=o>=</span> <span class=n>rng</span><span class=o>.</span><span class=n>permutation</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span><span id=__span-11-128><a id=__codelineno-11-128 name=__codelineno-11-128 href=#__codelineno-11-128></a>        <span class=k>for</span> <span class=n>start</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>batch_size</span><span class=p>):</span>
</span><span id=__span-11-129><a id=__codelineno-11-129 name=__codelineno-11-129 href=#__codelineno-11-129></a>            <span class=n>b</span> <span class=o>=</span> <span class=n>idx</span><span class=p>[</span><span class=n>start</span><span class=p>:</span><span class=n>start</span><span class=o>+</span><span class=n>batch_size</span><span class=p>]</span>
</span><span id=__span-11-130><a id=__codelineno-11-130 name=__codelineno-11-130 href=#__codelineno-11-130></a>            <span class=n>probs</span><span class=p>,</span> <span class=n>caches</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>forward</span><span class=p>(</span><span class=n>Xtr</span><span class=p>[</span><span class=n>b</span><span class=p>])</span>
</span><span id=__span-11-131><a id=__codelineno-11-131 name=__codelineno-11-131 href=#__codelineno-11-131></a>            <span class=n>dW</span><span class=p>,</span> <span class=n>db</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>backward</span><span class=p>(</span><span class=n>probs</span><span class=p>,</span> <span class=n>ytr</span><span class=p>[</span><span class=n>b</span><span class=p>],</span> <span class=n>caches</span><span class=p>)</span>
</span><span id=__span-11-132><a id=__codelineno-11-132 name=__codelineno-11-132 href=#__codelineno-11-132></a>            <span class=n>model</span><span class=o>.</span><span class=n>step</span><span class=p>(</span><span class=n>dW</span><span class=p>,</span> <span class=n>db</span><span class=p>,</span> <span class=n>lr</span><span class=p>)</span>
</span><span id=__span-11-133><a id=__codelineno-11-133 name=__codelineno-11-133 href=#__codelineno-11-133></a>        <span class=c1># metrics</span>
</span><span id=__span-11-134><a id=__codelineno-11-134 name=__codelineno-11-134 href=#__codelineno-11-134></a>        <span class=n>tr_pred</span><span class=p>,</span> <span class=n>tr_probs</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>Xtr</span><span class=p>)</span>
</span><span id=__span-11-135><a id=__codelineno-11-135 name=__codelineno-11-135 href=#__codelineno-11-135></a>        <span class=n>va_pred</span><span class=p>,</span> <span class=n>va_probs</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>Xva</span><span class=p>)</span>
</span><span id=__span-11-136><a id=__codelineno-11-136 name=__codelineno-11-136 href=#__codelineno-11-136></a>        <span class=n>tr_acc</span> <span class=o>=</span> <span class=n>accuracy</span><span class=p>(</span><span class=n>ytr</span><span class=p>,</span> <span class=n>tr_pred</span><span class=p>)</span>
</span><span id=__span-11-137><a id=__codelineno-11-137 name=__codelineno-11-137 href=#__codelineno-11-137></a>        <span class=n>va_acc</span> <span class=o>=</span> <span class=n>accuracy</span><span class=p>(</span><span class=n>yva</span><span class=p>,</span> <span class=n>va_pred</span><span class=p>)</span>
</span><span id=__span-11-138><a id=__codelineno-11-138 name=__codelineno-11-138 href=#__codelineno-11-138></a>        <span class=n>tr_loss</span> <span class=o>=</span> <span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>tr_probs</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>Xtr</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=n>ytr</span><span class=p>]</span> <span class=o>+</span> <span class=mf>1e-12</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-11-139><a id=__codelineno-11-139 name=__codelineno-11-139 href=#__codelineno-11-139></a>        <span class=n>va_loss</span> <span class=o>=</span> <span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>log</span><span class=p>(</span><span class=n>va_probs</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>Xva</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=n>yva</span><span class=p>]</span> <span class=o>+</span> <span class=mf>1e-12</span><span class=p>)</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span><span id=__span-11-140><a id=__codelineno-11-140 name=__codelineno-11-140 href=#__codelineno-11-140></a>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>"epoch </span><span class=si>{</span><span class=n>epoch</span><span class=si>:</span><span class=s2>03d</span><span class=si>}</span><span class=s2> | train loss </span><span class=si>{</span><span class=n>tr_loss</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2> acc </span><span class=si>{</span><span class=n>tr_acc</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2> | val loss </span><span class=si>{</span><span class=n>va_loss</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2> acc </span><span class=si>{</span><span class=n>va_acc</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</span><span id=__span-11-141><a id=__codelineno-11-141 name=__codelineno-11-141 href=#__codelineno-11-141></a>
</span><span id=__span-11-142><a id=__codelineno-11-142 name=__codelineno-11-142 href=#__codelineno-11-142></a><span class=c1># main function with arg parse</span>
</span><span id=__span-11-143><a id=__codelineno-11-143 name=__codelineno-11-143 href=#__codelineno-11-143></a><span class=k>def</span><span class=w> </span><span class=nf>main</span><span class=p>():</span>
</span><span id=__span-11-144><a id=__codelineno-11-144 name=__codelineno-11-144 href=#__codelineno-11-144></a>    <span class=n>ap</span> <span class=o>=</span> <span class=n>argparse</span><span class=o>.</span><span class=n>ArgumentParser</span><span class=p>()</span>
</span><span id=__span-11-145><a id=__codelineno-11-145 name=__codelineno-11-145 href=#__codelineno-11-145></a>    <span class=n>ap</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>"--data"</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=s2>"data/processed/processed.csv"</span><span class=p>)</span>
</span><span id=__span-11-146><a id=__codelineno-11-146 name=__codelineno-11-146 href=#__codelineno-11-146></a>    <span class=n>ap</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>"--hidden"</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=s2>"64"</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s1>'e.g. "64" or "128,64,32"'</span><span class=p>)</span>
</span><span id=__span-11-147><a id=__codelineno-11-147 name=__codelineno-11-147 href=#__codelineno-11-147></a>    <span class=n>ap</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>"--activation"</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>str</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=s2>"relu"</span><span class=p>,</span> <span class=n>choices</span><span class=o>=</span><span class=p>[</span><span class=s2>"relu"</span><span class=p>,</span><span class=s2>"tanh"</span><span class=p>,</span><span class=s2>"sigmoid"</span><span class=p>])</span>
</span><span id=__span-11-148><a id=__codelineno-11-148 name=__codelineno-11-148 href=#__codelineno-11-148></a>    <span class=n>ap</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>"--epochs"</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>int</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
</span><span id=__span-11-149><a id=__codelineno-11-149 name=__codelineno-11-149 href=#__codelineno-11-149></a>    <span class=n>ap</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>"--lr"</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>float</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mf>0.05</span><span class=p>)</span>
</span><span id=__span-11-150><a id=__codelineno-11-150 name=__codelineno-11-150 href=#__codelineno-11-150></a>    <span class=n>ap</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>"--batch_size"</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>int</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>256</span><span class=p>)</span>
</span><span id=__span-11-151><a id=__codelineno-11-151 name=__codelineno-11-151 href=#__codelineno-11-151></a>    <span class=n>ap</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>"--val_ratio"</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>float</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mf>0.15</span><span class=p>)</span>
</span><span id=__span-11-152><a id=__codelineno-11-152 name=__codelineno-11-152 href=#__codelineno-11-152></a>    <span class=n>ap</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>"--test_ratio"</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>float</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mf>0.15</span><span class=p>)</span>
</span><span id=__span-11-153><a id=__codelineno-11-153 name=__codelineno-11-153 href=#__codelineno-11-153></a>    <span class=n>ap</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>"--seed"</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>int</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mi>42</span><span class=p>)</span>
</span><span id=__span-11-154><a id=__codelineno-11-154 name=__codelineno-11-154 href=#__codelineno-11-154></a>    <span class=n>ap</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>"--l2"</span><span class=p>,</span> <span class=nb>type</span><span class=o>=</span><span class=nb>float</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=mf>0.0</span><span class=p>)</span>
</span><span id=__span-11-155><a id=__codelineno-11-155 name=__codelineno-11-155 href=#__codelineno-11-155></a>    <span class=n>args</span> <span class=o>=</span> <span class=n>ap</span><span class=o>.</span><span class=n>parse_args</span><span class=p>()</span>
</span><span id=__span-11-156><a id=__codelineno-11-156 name=__codelineno-11-156 href=#__codelineno-11-156></a>
</span><span id=__span-11-157><a id=__codelineno-11-157 name=__codelineno-11-157 href=#__codelineno-11-157></a>    <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=n>args</span><span class=o>.</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-11-158><a id=__codelineno-11-158 name=__codelineno-11-158 href=#__codelineno-11-158></a>    <span class=n>y</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(</span><span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>int64</span><span class=p>)</span>
</span><span id=__span-11-159><a id=__codelineno-11-159 name=__codelineno-11-159 href=#__codelineno-11-159></a>    <span class=n>X</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>:]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(</span><span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span>
</span><span id=__span-11-160><a id=__codelineno-11-160 name=__codelineno-11-160 href=#__codelineno-11-160></a>
</span><span id=__span-11-161><a id=__codelineno-11-161 name=__codelineno-11-161 href=#__codelineno-11-161></a>    <span class=n>uniq</span><span class=p>,</span> <span class=n>y_mapped</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>unique</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>return_inverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-11-162><a id=__codelineno-11-162 name=__codelineno-11-162 href=#__codelineno-11-162></a>    <span class=n>y</span> <span class=o>=</span> <span class=n>y_mapped</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>int64</span><span class=p>)</span>
</span><span id=__span-11-163><a id=__codelineno-11-163 name=__codelineno-11-163 href=#__codelineno-11-163></a>    <span class=n>num_classes</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>uniq</span><span class=p>)</span>
</span><span id=__span-11-164><a id=__codelineno-11-164 name=__codelineno-11-164 href=#__codelineno-11-164></a>
</span><span id=__span-11-165><a id=__codelineno-11-165 name=__codelineno-11-165 href=#__codelineno-11-165></a>    <span class=n>tr</span><span class=p>,</span> <span class=n>va</span><span class=p>,</span> <span class=n>te</span> <span class=o>=</span> <span class=n>stratified_split</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>train</span><span class=o>=</span><span class=mf>1.0</span><span class=o>-</span><span class=n>args</span><span class=o>.</span><span class=n>val_ratio</span><span class=o>-</span><span class=n>args</span><span class=o>.</span><span class=n>test_ratio</span><span class=p>,</span> <span class=n>val</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>val_ratio</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>seed</span><span class=p>)</span>
</span><span id=__span-11-166><a id=__codelineno-11-166 name=__codelineno-11-166 href=#__codelineno-11-166></a>    <span class=p>(</span><span class=n>Xtr</span><span class=p>,</span> <span class=n>ytr</span><span class=p>),</span> <span class=p>(</span><span class=n>Xva</span><span class=p>,</span> <span class=n>yva</span><span class=p>),</span> <span class=p>(</span><span class=n>Xte</span><span class=p>,</span> <span class=n>yte</span><span class=p>)</span> <span class=o>=</span> <span class=n>tr</span><span class=p>,</span> <span class=n>va</span><span class=p>,</span> <span class=n>te</span>
</span><span id=__span-11-167><a id=__codelineno-11-167 name=__codelineno-11-167 href=#__codelineno-11-167></a>
</span><span id=__span-11-168><a id=__codelineno-11-168 name=__codelineno-11-168 href=#__codelineno-11-168></a>    <span class=n>model</span> <span class=o>=</span> <span class=n>MLP</span><span class=p>(</span>
</span><span id=__span-11-169><a id=__codelineno-11-169 name=__codelineno-11-169 href=#__codelineno-11-169></a>        <span class=n>input_dim</span><span class=o>=</span><span class=n>Xtr</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span>
</span><span id=__span-11-170><a id=__codelineno-11-170 name=__codelineno-11-170 href=#__codelineno-11-170></a>        <span class=n>hidden_layers</span><span class=o>=</span><span class=n>parse_hidden</span><span class=p>(</span><span class=n>args</span><span class=o>.</span><span class=n>hidden</span><span class=p>),</span>
</span><span id=__span-11-171><a id=__codelineno-11-171 name=__codelineno-11-171 href=#__codelineno-11-171></a>        <span class=n>num_classes</span><span class=o>=</span><span class=n>num_classes</span><span class=p>,</span>
</span><span id=__span-11-172><a id=__codelineno-11-172 name=__codelineno-11-172 href=#__codelineno-11-172></a>        <span class=n>activation</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>activation</span><span class=p>,</span>
</span><span id=__span-11-173><a id=__codelineno-11-173 name=__codelineno-11-173 href=#__codelineno-11-173></a>        <span class=n>seed</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>seed</span><span class=p>,</span>
</span><span id=__span-11-174><a id=__codelineno-11-174 name=__codelineno-11-174 href=#__codelineno-11-174></a>        <span class=n>l2</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>l2</span>
</span><span id=__span-11-175><a id=__codelineno-11-175 name=__codelineno-11-175 href=#__codelineno-11-175></a>    <span class=p>)</span>
</span><span id=__span-11-176><a id=__codelineno-11-176 name=__codelineno-11-176 href=#__codelineno-11-176></a>
</span><span id=__span-11-177><a id=__codelineno-11-177 name=__codelineno-11-177 href=#__codelineno-11-177></a>    <span class=c1># train</span>
</span><span id=__span-11-178><a id=__codelineno-11-178 name=__codelineno-11-178 href=#__codelineno-11-178></a>    <span class=n>train</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>Xtr</span><span class=p>,</span> <span class=n>ytr</span><span class=p>,</span> <span class=n>Xva</span><span class=p>,</span> <span class=n>yva</span><span class=p>,</span> <span class=n>epochs</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>epochs</span><span class=p>,</span> <span class=n>lr</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>lr</span><span class=p>,</span> <span class=n>batch_size</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>batch_size</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>seed</span><span class=p>)</span>
</span><span id=__span-11-179><a id=__codelineno-11-179 name=__codelineno-11-179 href=#__codelineno-11-179></a>
</span><span id=__span-11-180><a id=__codelineno-11-180 name=__codelineno-11-180 href=#__codelineno-11-180></a>    <span class=c1># test</span>
</span><span id=__span-11-181><a id=__codelineno-11-181 name=__codelineno-11-181 href=#__codelineno-11-181></a>    <span class=n>yhat</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>predict</span><span class=p>(</span><span class=n>Xte</span><span class=p>)</span>
</span><span id=__span-11-182><a id=__codelineno-11-182 name=__codelineno-11-182 href=#__codelineno-11-182></a>    <span class=n>test_acc</span> <span class=o>=</span> <span class=n>accuracy</span><span class=p>(</span><span class=n>yte</span><span class=p>,</span> <span class=n>yhat</span><span class=p>)</span>
</span><span id=__span-11-183><a id=__codelineno-11-183 name=__codelineno-11-183 href=#__codelineno-11-183></a>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>"</span><span class=se>\n</span><span class=s2>Test accuracy: </span><span class=si>{</span><span class=n>test_acc</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</span><span id=__span-11-184><a id=__codelineno-11-184 name=__codelineno-11-184 href=#__codelineno-11-184></a>
</span><span id=__span-11-185><a id=__codelineno-11-185 name=__codelineno-11-185 href=#__codelineno-11-185></a><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>"__main__"</span><span class=p>:</span>
</span><span id=__span-11-186><a id=__codelineno-11-186 name=__codelineno-11-186 href=#__codelineno-11-186></a>    <span class=n>main</span><span class=p>()</span>
</span></code></pre></div> <h3 id=summary>Summary</h3> <p>In this step, the MLP was implemented using only Numpy in a flexible way, so that a user can select the hyperparameters of the model, the architecture, activation functions, etc. This completes the implementation of the core model, which will be evaluated in the next section. </p> <hr> <p><em>Note</em>: Artificial Intelligence was used in this exercise for code completion and review, as well as for text revision and refinement.</p> <h2 id=5-model-training>5. Model Training</h2> <p>We train the NumPy MLP using <strong>mini‑batch SGD</strong> and cross‑entropy. The training loop implements: <strong>forward propagation → loss calculation → backpropagation → parameter updates</strong>. We initialize weights randomly (small variance) and optionally apply <strong>L2 penalty</strong> to reduce overfitting.</p> <p><strong>Python (core idea):</strong> </p><div class="language-python highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=kn>from</span><span class=w> </span><span class=nn>mlp_numpy</span><span class=w> </span><span class=kn>import</span> <span class=n>MLP</span><span class=p>,</span> <span class=n>stratified_split</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=kn>import</span><span class=w> </span><span class=nn>numpy</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>np</span><span class=o>,</span><span class=w> </span><span class=nn>pandas</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>pd</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s2>"src/data/clean/bank-additional-full-post-preprocessed.csv"</span><span class=p>)</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=n>y</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(</span><span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>int64</span><span class=p>)</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=n>X</span> <span class=o>=</span> <span class=n>df</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:,</span><span class=mi>1</span><span class=p>:]</span><span class=o>.</span><span class=n>to_numpy</span><span class=p>(</span><span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=p>(</span><span class=n>Xtr</span><span class=p>,</span><span class=n>ytr</span><span class=p>),</span> <span class=p>(</span><span class=n>Xva</span><span class=p>,</span><span class=n>yva</span><span class=p>),</span> <span class=p>(</span><span class=n>Xte</span><span class=p>,</span><span class=n>yte</span><span class=p>)</span> <span class=o>=</span> <span class=n>stratified_split</span><span class=p>(</span><span class=n>X</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>train</span><span class=o>=</span><span class=mf>0.70</span><span class=p>,</span> <span class=n>val</span><span class=o>=</span><span class=mf>0.15</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>)</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=n>model</span> <span class=o>=</span> <span class=n>MLP</span><span class=p>(</span><span class=n>input_dim</span><span class=o>=</span><span class=n>X</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>hidden_layers</span><span class=o>=</span><span class=p>[</span><span class=mi>128</span><span class=p>,</span><span class=mi>64</span><span class=p>],</span> <span class=n>num_classes</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>unique</span><span class=p>(</span><span class=n>y</span><span class=p>)),</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a>            <span class=n>activation</span><span class=o>=</span><span class=s2>"relu"</span><span class=p>,</span> <span class=n>l2</span><span class=o>=</span><span class=mf>1e-4</span><span class=p>,</span> <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>)</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=c1># training loop: forward -&gt; loss -&gt; backward -&gt; step</span>
</span></code></pre></div> <strong>CLI (reproducible baseline):</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>python<span class=w> </span>src/step5_train_mlp.py<span class=w> </span>--data<span class=w> </span>src/data/clean/bank-additional-full-post-preprocessed.csv<span class=w> </span>--hidden<span class=w> </span><span class=m>128</span>,64<span class=w> </span>--activation<span class=w> </span>relu<span class=w> </span>--epochs<span class=w> </span><span class=m>60</span><span class=w> </span>--lr<span class=w> </span><span class=m>0</span>.03<span class=w> </span>--batch_size<span class=w> </span><span class=m>512</span><span class=w> </span>--l2<span class=w> </span>1e-4<span class=w> </span>--seed<span class=w> </span><span class=m>42</span>
</span></code></pre></div> <strong>Challenges &amp; fixes.</strong> To avoid saturation/vanishing gradients we prefer <strong>ReLU</strong> over <code>tanh/sigmoid</code> for hidden layers; we keep inputs standardized; and we use <strong>early stopping</strong> (below) plus mild <strong>L2</strong> to control overfitting.<p></p> <hr> <h2 id=6-training-testing-strategy>6. Training &amp; Testing Strategy</h2> <ul> <li><strong>Split:</strong> stratified <strong>70/15/15</strong> (train/validation/test) with seed <strong>42</strong> for reproducibility. </li> <li><strong>Training mode:</strong> <strong>mini‑batch</strong> (batch size 512) balances speed and stability. </li> <li><strong>Early stopping:</strong> on validation loss with <code>patience=10</code>, <code>min_delta=1e-4</code>. </li> <li><strong>Rationale:</strong> Validation guides hyperparameter tuning (hidden sizes, LR, patience, L2).</li> </ul> <p><strong>CLI (final early‑stopped run):</strong> </p><div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a>python<span class=w> </span>src/step6_strategy.py<span class=w> </span>--data<span class=w> </span>src/data/clean/bank-additional-full-post-preprocessed.csv<span class=w> </span>--hidden<span class=w> </span><span class=m>256</span>,128,64<span class=w> </span>--activation<span class=w> </span>relu<span class=w> </span>--epochs<span class=w> </span><span class=m>80</span><span class=w> </span>--lr<span class=w> </span><span class=m>0</span>.025<span class=w> </span>--batch_size<span class=w> </span><span class=m>512</span><span class=w> </span>--patience<span class=w> </span><span class=m>10</span><span class=w> </span>--min_delta<span class=w> </span>1e-4<span class=w> </span>--l2<span class=w> </span>1e-4<span class=w> </span>--seed<span class=w> </span><span class=m>123</span>
</span></code></pre></div> <strong>Curves (deep/wide run):</strong><br> <a class=glightbox data-type=image data-width=auto data-height=auto href=../images/curves_step6_deep_loss.png data-desc-position=bottom><img alt="Loss vs. Epochs" src=../images/curves_step6_deep_loss.png></a><br> <a class=glightbox data-type=image data-width=auto data-height=auto href=../images/curves_step6_deep_acc.png data-desc-position=bottom><img alt="Accuracy vs. Epochs" src=../images/curves_step6_deep_acc.png></a><p></p> <hr> <h2 id=7-error-curves-and-visualization>7. Error Curves and Visualization</h2> <p>We <strong>show four plots</strong> to analyze convergence and generalization: training/validation <strong>loss</strong> and <strong>accuracy</strong> for a quick baseline and for the final deep/wide model.</p> <p><strong>Notebook:</strong> <code>src/step7_curves.ipynb</code></p> <p><strong>Quick baseline (32×32)</strong><br> <a class=glightbox data-type=image data-width=auto data-height=auto href=../images/curves_step6_quick_loss.png data-desc-position=bottom><img alt="Loss — quick" src=../images/curves_step6_quick_loss.png></a><br> <a class=glightbox data-type=image data-width=auto data-height=auto href=../images/curves_step6_quick_acc.png data-desc-position=bottom><img alt="Accuracy — quick" src=../images/curves_step6_quick_acc.png></a></p> <p><strong>Deep/Wide (256×128×64)</strong><br> <a class=glightbox data-type=image data-width=auto data-height=auto href=../images/curves_step6_deep_loss.png data-desc-position=bottom><img alt="Loss — deep/wide" src=../images/curves_step6_deep_loss.png></a><br> <a class=glightbox data-type=image data-width=auto data-height=auto href=../images/curves_step6_deep_acc.png data-desc-position=bottom><img alt="Accuracy — deep/wide" src=../images/curves_step6_deep_acc.png></a></p> <p><strong>Interpretation.</strong> The training curves reveal several important patterns:</p> <p><strong>Early Training Phase (Epochs 1-20):</strong> Both training and validation metrics improve steadily, with validation accuracy actually exceeding training accuracy initially. This suggests the model is learning generalizable patterns effectively.</p> <p><strong>Peak Performance (Epoch 21):</strong> Validation accuracy reaches its maximum at <strong>0.9024</strong> (epoch 21), indicating the optimal point before overfitting begins. The validation loss also reaches its minimum around this time.</p> <p><strong>Overfitting Transition (Epochs 30-50):</strong> Around epoch 30, we observe a subtle but important shift: - <strong>Validation accuracy plateaus</strong> and begins fluctuating around 0.900-0.902, while <strong>training accuracy continues improving</strong> (reaching 0.900+ by epoch 45) - The <strong>accuracy gap reverses</strong>: Initially validation &gt; training (negative gap), but by epoch 45-50, training &gt; validation (positive gap) - <strong>Loss behavior mirrors this pattern</strong>: Validation loss initially lower than training loss, but the gap narrows and eventually reverses</p> <p><strong>Late Training Phase (Epochs 50+):</strong> Clear overfitting emerges as training accuracy continues rising while validation accuracy stagnates or slightly declines. The model becomes increasingly specialized to the training set.</p> <p><strong>Early Stopping Effectiveness:</strong> The model stopped at epoch 65 with the best validation performance at epoch 55, demonstrating that early stopping successfully prevented severe overfitting. The final model maintains good generalization despite the overfitting trend in later epochs.</p> <p><strong>Key Insights:</strong> - <strong>Standardized inputs and L2 regularization</strong> (λ=1e-4) help control overfitting but don't eliminate it entirely - The <strong>deep architecture</strong> (256×128×64) has sufficient capacity to overfit, but early stopping provides effective regularization - The <strong>validation set effectively guides</strong> hyperparameter selection and prevents overfitting</p> <h2 id=8-evaluation-metrics>8. Evaluation Metrics</h2> <p><strong>Notebook:</strong> <code>src/step8_metrics.ipynb</code></p> <p>We evaluate on the <strong>held‑out test set</strong> and compare to a <strong>majority‑class baseline</strong>. Because the dataset is <strong>imbalanced</strong>, we report <strong>ROC‑AUC</strong> and <strong>PR‑AUC</strong> (in addition to accuracy). We include a <strong>confusion matrix heatmap</strong> and the <strong>per‑class precision/recall/F1</strong> table.</p> <h3 id=summary-metrics>Summary metrics:</h3> <table> <thead> <tr> <th>Metric</th> <th>Value</th> <th>Interpretation</th> </tr> </thead> <tbody> <tr> <td><strong>Accuracy</strong></td> <td>0.897</td> <td>Overall 89.7 % correct predictions; inflated by majority class</td> </tr> <tr> <td><strong>Baseline Accuracy</strong></td> <td>0.883</td> <td>Always predicting 0 (majority) would already get 88.3 % — so accuracy alone isn’t very informative</td> </tr> <tr> <td><strong>ROC–AUC</strong></td> <td>0.790</td> <td>Good discrimination ability across thresholds</td> </tr> <tr> <td><strong>PR–AUC</strong></td> <td>0.458</td> <td>Moderate; model can identify some positives better than random</td> </tr> </tbody> </table> <h3 id=confusion-matrix>Confusion Matrix</h3> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/metrics_step8_cm.png data-desc-position=bottom><img alt="Confusion Matrix" src=../images/metrics_step8_cm.png></a> </p> <table> <thead> <tr> <th>True Class ↓ / Predicted →</th> <th>0</th> <th>1</th> </tr> </thead> <tbody> <tr> <td><strong>0 (negative)</strong></td> <td>5121</td> <td>101</td> </tr> <tr> <td><strong>1 (positive)</strong></td> <td>510</td> <td>181</td> </tr> </tbody> </table> <p><strong>Interpretation:</strong></p> <ul> <li><strong>True Negatives (TN):</strong> 5121 → The model correctly predicted class 0 (negative) for 5121 samples.</li> <li><strong>False Positives (FP):</strong> 101 → 101 samples were incorrectly classified as positive.</li> <li><strong>False Negatives (FN):</strong> 510 → 510 actual positives were missed (classified as 0).</li> <li><strong>True Positives (TP):</strong> 181 → 181 actual positives were correctly detected.</li> </ul> <p>So while the overall accuracy is <strong>high (0.897)</strong>, that’s largely because class 0 dominates — the model is very good at recognizing negatives but struggles with positives.</p> <hr> <h3 id=roc-curve>ROC Curve</h3> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/metrics_step8_roc.png data-desc-position=bottom><img alt="ROC Curve" src=../images/metrics_step8_roc.png></a> </p> <p>The <strong>Receiver Operating Characteristic</strong> (ROC Curve (AUC = 0.790)) curve plots:</p> <ul> <li><strong>x-axis:</strong> False Positive Rate (1 − Specificity)</li> <li><strong>y-axis:</strong> True Positive Rate (Recall or Sensitivity)</li> </ul> <p>The <strong>AUC (Area Under Curve)</strong> measures how well the model separates the two classes regardless of threshold.</p> <p><strong>Interpretation:</strong></p> <ul> <li><strong>AUC = 0.5:</strong> random guessing</li> <li><strong>AUC = 1.0:</strong> perfect separation</li> <li><strong>Your AUC = 0.79:</strong> good — the model can discriminate between classes better than random, but not perfectly. In practical terms, given one random positive and one random negative, the model assigns the positive a higher score ~79 % of the time.</li> </ul> <p>The curve shape (steep rise near the origin, then tapering) suggests it achieves high recall with relatively few false positives early on, then saturates as threshold decreases.</p> <hr> <h3 id=precisionrecall-curve>Precision–Recall Curve</h3> <p><a class=glightbox data-type=image data-width=auto data-height=auto href=../images/metrics_step8_pr.png data-desc-position=bottom><img alt="Precision–Recall Curve" src=../images/metrics_step8_pr.png></a></p> <p>This plot is more <strong>informative for imbalanced datasets</strong> like yours.</p> <ul> <li><strong>Precision:</strong> TP / (TP + FP) — how many predicted positives are correct.</li> <li><strong>Recall:</strong> TP / (TP + FN) — how many actual positives are detected.</li> <li><strong>AP (Average Precision):</strong> area under the Precision–Recall curve (similar to AUC).</li> </ul> <p><strong>Interpretation:</strong></p> <ul> <li>Baseline (dotted line) represents the <strong>positive class prevalence</strong>. So the model’s precision is substantially above random across much of the curve.</li> <li><strong>AP = 0.458</strong> indicates moderate ability to rank positive cases above negatives, but still many false positives when recall increases.</li> <li>The sharp initial peaks show that at stricter thresholds, the model can achieve <strong>very high precision</strong> (but only for a small number of cases).</li> </ul> <hr> <h3 id=perclass-metrics><strong>Per‑class metrics:</strong></h3> <table> <thead> <tr> <th style="text-align: left;">Class</th> <th style="text-align: right;">Precision</th> <th style="text-align: right;">Recall</th> <th style="text-align: right;">F1-score</th> <th style="text-align: right;">Support</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">0</td> <td style="text-align: right;">0.909</td> <td style="text-align: right;">0.981</td> <td style="text-align: right;">0.944</td> <td style="text-align: right;">5222</td> </tr> <tr> <td style="text-align: left;">1</td> <td style="text-align: right;">0.642</td> <td style="text-align: right;">0.262</td> <td style="text-align: right;">0.372</td> <td style="text-align: right;">691</td> </tr> <tr> <td style="text-align: left;">macro avg</td> <td style="text-align: right;">0.776</td> <td style="text-align: right;">0.621</td> <td style="text-align: right;">0.658</td> <td style="text-align: right;">5913</td> </tr> <tr> <td style="text-align: left;">weighted avg</td> <td style="text-align: right;">0.878</td> <td style="text-align: right;">0.897</td> <td style="text-align: right;">0.877</td> <td style="text-align: right;">5913</td> </tr> </tbody> </table> <h3 id=interpretation>Interpretation</h3> <h4 id=class-0-majority>Class 0 (majority)</h4> <ul> <li><strong>Precision = 0.909</strong> → About 91 % of predicted 0’s are truly 0.</li> <li><strong>Recall = 0.981</strong> → The model correctly finds almost all real 0’s (misses only ~2 %).</li> <li><strong>F1 = 0.944</strong> → Excellent overall balance between precision and recall.</li> <li><strong>Interpretation:</strong> The classifier is very reliable when identifying class 0.</li> </ul> <h4 id=class-1-minority>Class 1 (minority)</h4> <ul> <li><strong>Precision = 0.642</strong> → Roughly two-thirds of predicted 1’s are correct.</li> <li><strong>Recall = 0.262</strong> → Detects only about a quarter of the actual positives.</li> <li><strong>F1 = 0.372</strong> → Weak combined performance, driven by low recall.</li> <li><strong>Interpretation:</strong> The model struggles to capture true positives, producing many false negatives.</li> </ul> <h4 id=macro-averages-unweighted>Macro averages (unweighted)</h4> <ul> <li><strong>Precision = 0.776</strong>, <strong>Recall = 0.621</strong>, <strong>F1 = 0.658</strong></li> <li>Treats both classes equally.</li> <li>Shows moderate overall discrimination but clear imbalance between the two classes.</li> </ul> <h4 id=weighted-averages-by-class-frequency>Weighted averages (by class frequency)</h4> <ul> <li><strong>Precision = 0.878</strong>, <strong>Recall = 0.897</strong>, <strong>F1 = 0.877</strong></li> <li>Dominated by class 0 performance.</li> <li>Closely matches overall test accuracy (~0.897).</li> </ul> <p><strong>Notes.</strong> As typical in imbalanced settings, recall for the positive class is lower at default threshold 0.5; <strong>threshold tuning</strong>, <strong>class weighting</strong>, or <strong>cost‑sensitive</strong> optimization can raise recall for the positive class with acceptable precision trade‑offs.</p> <h2 id=9-conclusion>9. Conclusion</h2> <ul> <li>The model is <strong>excellent at predicting the majority class</strong> but <strong>weak on minority detection</strong>.</li> <li>Future improvements should target <strong>raising recall for class 1</strong> — e.g., by resampling, adjusting thresholds, or rebalancing the loss function.</li> </ul> <p><strong>Findings.</strong> A from‑scratch NumPy MLP with mini‑batch SGD and early stopping reaches strong ranking metrics on the Bank Marketing dataset, outperforming a majority baseline.</p> <p><strong>Limitations.</strong> Plain MLPs do not directly address class imbalance and may require threshold tuning; probability calibration is not ensured.</p> <p><strong>Future work.</strong> Class‑weighting or focal loss, wider architecture/regularization sweeps, feature engineering on contact history/time, and comparison with gradient‑boosted trees.</p> <hr> <h3 id=submission-github-pages>Submission — GitHub Pages</h3> <p>This report (Steps 1–8, Conclusion, and References) is designed for <strong>GitHub Pages</strong> (course template compatible). All images live in <code>src/images/</code> and are referenced relatively.</p> <h3 id=academic-integrity-ai-collaboration>Academic Integrity &amp; AI Collaboration</h3> <p>AI assistance was used for code scaffolding, documentation, and figure generation. The authors understand and can explain all parts of the solution; plagiarism policies were respected.</p> <h3 id=references>References</h3> <ol> <li>Moro, S., Cortez, P., &amp; Rita, P. (2014). <em>A Data‑Driven Approach to Predict the Success of Bank Telemarketing</em>. Decision Support Systems, 62, 22–31. (UCI Bank Marketing) </li> <li>Rumelhart, D. E., Hinton, G. E., &amp; Williams, R. J. (1986). <em>Learning representations by back‑propagating errors</em>. Nature, 323, 533–536. </li> <li>Goodfellow, I., Bengio, Y., &amp; Courville, A. (2016). <em>Deep Learning</em>. MIT Press (Chs. 6–7 for MLPs and optimization).</li> </ol> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="November 20, 2025 11:31:06 UTC">November 20, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="November 20, 2025 11:31:06 UTC">November 20, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Contributors> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"></path></svg> </span> <nav> <a href=mailto:thomaschiari@gmail.com>thomaschiari</a> </nav> </span> <span class=md-source-file__fact> <span class=md-icon title=Contributors> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33s1.71.11 2.5.33c1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2"></path></svg> </span> <span>GitHub</span> <nav> <a href=https://github.com/LuccaHiratsuca class=md-author title=@LuccaHiratsuca> <img src="https://avatars.githubusercontent.com/u/104103173?v=4&size=72" alt=LuccaHiratsuca> </a> <a href=https://github.com/FeMCDias class=md-author title=@FeMCDias> <img src="https://avatars.githubusercontent.com/u/101530321?v=4&size=72" alt=FeMCDias> </a> <a href=https://github.com/thomaschiari class=md-author title=@thomaschiari> <img src="https://avatars.githubusercontent.com/u/73441789?v=4&size=72" alt=thomaschiari> </a> </nav> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate", "content.tooltips", "navigation.instant", "navigation.instant.progress", "navigation.top", "navigation.path", "navigation.tracking", "navigation.expand"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.e71a0d61.min.js></script> <script src=../../assets/_markdown_exec_pyodide.js></script> <script src=https://unpkg.com/mathjax/es5/tex-mml-chtml.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=https://fastly.jsdelivr.net/npm/jquery/dist/jquery.min.js></script> <script src=https://fastly.jsdelivr.net/npm/echarts/dist/echarts.min.js></script> <script src=../../assets/javascripts/badge.js async></script> <script src=../../termynal.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>